<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings - Systemly</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700;900&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* The existing CSS is included here */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #F97316;
            --secondary: #6366F1;
            --accent: #14B8A6;
            --bg: #FFF7ED;
            --text: #1F2937;
            --white: #FFFFFF;
            --gray-light: #F3F4F6;
            --gray-medium: #9CA3AF;
            --gray-dark: #4B5563;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Archivo', sans-serif;
        }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            width: 100%;
            padding: 1.2rem 5%;
            background: rgba(255, 247, 237, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Archivo', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }

        .back-btn {
            background: var(--gray-light);
            color: var(--text);
            padding: 0.65rem 1.5rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: var(--gray-medium);
            color: var(--white);
            transform: translateX(-5px);
        }

        /* Main Container */
        .main-container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 5%;
            display: grid;
            grid-template-columns: 320px 1fr 280px;
            gap: 2rem;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Profile Card */
        .profile-card {
            background: var(--white);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            text-align: center;
            position: relative;
        }

        .profile-completion {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 1.5rem;
        }

        .completion-ring {
            transform: rotate(-90deg);
        }

        .completion-circle-bg {
            fill: none;
            stroke: var(--gray-light);
            stroke-width: 8;
        }

        .completion-circle {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease, stroke 0.5s;
        }

        .profile-avatar-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .edit-avatar-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 3px solid var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--white);
        }

        .edit-avatar-btn:hover {
            transform: scale(1.1);
        }

        .profile-avatar-wrapper input[type="file"] {
            display: none;
        }

        .completion-percentage {
    position: absolute;
    bottom: calc(100% + 8px); /* moves it above the avatar */
    left: 50%;
    transform: translateX(-50%);
    font-size: 1rem;
    font-weight: 700;
    color: var(--primary);
    text-shadow: 0 1px 2px rgba(0,0,0,0.05);
    z-index: 3; /* ensures it appears above all avatar layers */
}


        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .profile-email {
            color: var(--gray-medium);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        .profile-badges {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .badge-verified {
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--white);
        }

        .badge-seller {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
        }

        /* Plan Card */
        .plan-card {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--gray-medium), var(--gray-dark));
        }
        
        /* Plan-specific styles to override the default linear-gradient for the border */
        .plan-basic::before {
             background: linear-gradient(90deg, var(--primary), var(--warning));
        }

        .plan-premium::before {
             background: linear-gradient(90deg, var(--secondary), var(--accent));
        }

        .plan-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .plan-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
        }

        .plan-free .plan-icon {
            background: linear-gradient(135deg, var(--gray-medium), var(--gray-dark));
        }

        .plan-basic .plan-icon {
            background: linear-gradient(135deg, var(--primary), var(--warning));
        }

        .plan-premium .plan-icon {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
        }

        .plan-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.2rem;
        }

        .plan-info p {
            color: var(--gray-medium);
            font-size: 0.9rem;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 1.5rem;
        }

        .plan-features li {
            padding: 0.7rem 0;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 0.95rem;
        }

        .plan-features li i.fa-circle-check {
            color: var(--success);
            font-size: 0.9rem;
        }
        
        .plan-features li i.fa-circle-xmark {
            color: var(--error);
            font-size: 0.9rem;
        }

        .plan-features li.disabled {
            color: var(--gray-medium);
            opacity: 0.7; /* Slightly higher opacity for better contrast */
        }


        .upgrade-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 1rem;
            border-radius: 15px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.3);
        }

        .upgrade-btn.current {
            background: var(--gray-light);
            color: var(--gray-dark);
            cursor: default;
            font-weight: 700;
        }

        .upgrade-btn.current:hover {
            transform: none;
            box-shadow: none;
        }
        
        /* Specific plan button colors for Basic/Premium */
        .plan-basic .upgrade-btn {
             background: linear-gradient(135deg, var(--secondary), var(--accent));
        }
        
        .plan-premium .upgrade-btn {
            /* Handled by .current class */
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Settings Section */
        .settings-section {
            background: var(--white);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-light);
        }

        .section-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(99, 102, 241, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .section-header h2 {
            font-size: 1.8rem;
            font-weight: 900;
        }

        /* Form Groups */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
            outline: none;
            background: var(--white);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--gray-medium);
            margin-top: 0.5rem;
        }

        .char-count {
            font-size: 0.85rem;
            color: var(--gray-medium);
            text-align: right;
            margin-top: 0.3rem;
        }

        /* Save Button */
        .save-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 1rem 2.5rem;
            border-radius: 15px;
            border: none;
            font-weight: 600;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.3);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Success Message */
        .success-message {
            display: none;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            align-items: center;
            gap: 0.8rem;
            animation: slideInDown 0.5s ease-out;
        }

        .success-message.show {
            display: flex;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Danger Zone */
        .danger-zone {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(249, 115, 22, 0.05));
            border: 2px solid rgba(239, 68, 68, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
        }

        .danger-zone h4 {
            color: var(--error);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .danger-zone p {
            color: var(--gray-dark);
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .danger-btn {
            background: var(--error);
            color: var(--white);
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
        }

        .danger-btn:hover {
            background: #DC2626;
            transform: translateY(-2px);
        }

        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 320px 1fr;
            }
            
            aside:last-of-type {
                display: none;
            }
        }
        
        @media (max-width: 968px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: 2;
            }

            .main-content {
                order: 1;
            }
        }

        @media (max-width: 480px) {
            .settings-section {
                padding: 1.5rem;
            }

            .profile-card {
                padding: 1.5rem;
            }
        }

.badge-verified {
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--white);
        }

/* Add these new form styles */
.form-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 2px solid var(--gray-light);
}

.form-section:last-child {
    border-bottom: none;
}

.section-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.section-title i {
    color: var(--primary);
    font-size: 1.2rem;
}

.form-checkbox-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.form-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-label {
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Update form-input to support readonly state better */
.form-input[readonly] {
    background: var(--gray-light);
    cursor: not-allowed;
    color: var(--gray-dark);
}

/* Add styles for bank select dropdown */
.bank-logo {
    width: 24px;
    height: 24px;
    margin-right: 8px;
    vertical-align: middle;
}

/* TAB NAVIGATION STYLES */
.profile-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid var(--gray-light);
    overflow-x: auto;
    padding-bottom: 0;
}

.tab-btn {
    background: none;
    border: none;
    padding: 1rem 1.5rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--gray-medium);
    cursor: pointer;
    transition: all 0.3s;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
    font-family: 'Sarabun', sans-serif;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tab-btn:hover {
    color: var(--primary);
    background: rgba(249, 115, 22, 0.05);
}

.tab-btn.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: rgba(249, 115, 22, 0.05);
}

.tab-btn i {
    font-size: 1rem;
}

/* TAB CONTENT SECTIONS */
.tab-content {
    display: none;
    animation: fadeIn 0.4s ease-in-out;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* MODERN CARD STYLING FOR EACH SECTION */
.profile-section-card {
    background: var(--white);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 20px rgba(0,0,0,0.04);
    border: 1px solid var(--gray-light);
    transition: all 0.3s;
}

.profile-section-card:hover {
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    border-color: rgba(249, 115, 22, 0.2);
}

/* SECTION HEADERS WITH BETTER STYLING */
.section-header-new {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--gray-light);
}

.section-icon-new {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-size: 1.3rem;
    flex-shrink: 0;
}

.section-header-new h3 {
    font-size: 1.4rem;
    font-weight: 700;
    margin: 0;
}

.section-header-new p {
    color: var(--gray-medium);
    font-size: 0.9rem;
    margin: 0.3rem 0 0 0;
}

/* IMPROVED FORM ROW SPACING */
.form-row-new {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

/* PROGRESS INDICATORS FOR EACH SECTION */
.section-progress {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.05), rgba(99, 102, 241, 0.05));
    border-radius: 12px;
    border-left: 4px solid var(--primary);
}

.section-progress-bar {
    flex: 1;
    height: 8px;
    background: var(--gray-light);
    border-radius: 10px;
    overflow: hidden;
}

.section-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 10px;
    transition: width 0.5s ease;
}

.section-progress-text {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--primary);
    min-width: 60px;
    text-align: right;
}

/* COMPLETION BADGE */
.completion-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, var(--success), var(--accent));
    color: var(--white);
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-left: auto;
}

.completion-badge i {
    font-size: 1rem;
}

/* REQUIRED FIELD INDICATOR */
.required-indicator {
    color: var(--error);
    font-weight: 700;
    margin-left: 0.2rem;
}

/* HELP TEXT BOXES */
.help-box {
    background: rgba(99, 102, 241, 0.05);
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--secondary);
}

.help-box p {
    font-size: 0.9rem;
    color: var(--gray-dark);
    margin: 0;
    line-height: 1.5;
}

.help-box strong {
    color: var(--secondary);
}

/* FLOATING SAVE BUTTON */
.floating-save-container {
    position: sticky;
    bottom: 2rem;
    display: flex;
    justify-content: flex-end;
    margin-top: 2rem;
    z-index: 100;
}

.floating-save-btn {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--white);
    padding: 1rem 2.5rem;
    border-radius: 50px;
    border: none;
    font-weight: 600;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Sarabun', sans-serif;
    display: flex;
    align-items: center;
    gap: 0.7rem;
    box-shadow: 0 8px 25px rgba(249, 115, 22, 0.3);
}

.floating-save-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(249, 115, 22, 0.4);
}

/* MOBILE RESPONSIVE TABS */
@media (max-width: 768px) {
    .profile-tabs {
        gap: 0.25rem;
    }
    
    .tab-btn {
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
    }
    
    .tab-btn span {
        display: none;
    }
    
    .tab-btn i {
        margin: 0;
    }
}

/* Add to your <style> section */
.tab-btn.incomplete {
    position: relative;
}

.tab-btn.incomplete::after {
    content: '●';
    color: var(--error);
    font-size: 0.6rem;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
}

.tab-btn.complete::after {
    content: '✓';
    color: var(--success);
    font-size: 0.8rem;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
}








    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">Systemly</a>
            <a href="javascript:void(0);" class="back-btn" onclick="history.back()">
                Back to Dashboard
            </a>
        </div>
    </nav>

    <div class="main-container">
        <!-- LEFT SIDEBAR -->
        <aside class="sidebar">
            <div class="profile-card">
                <div class="profile-completion">
                    <svg class="completion-ring" width="140" height="140">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F97316;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#6366F1;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="gradient-basic" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F97316;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="gradient-premium" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#6366F1;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#14B8A6;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="completion-circle-bg" cx="70" cy="70" r="60"></circle>
                        <circle class="completion-circle" id="completionCircle" cx="70" cy="70" r="60" 
                                stroke-dasharray="377" stroke-dashoffset="377"></circle>
                    </svg>
                    <div class="profile-avatar-wrapper">
                        <img src="" alt="Profile" class="profile-avatar" id="profileAvatar">
                        <label for="avatarUpload" class="edit-avatar-btn" title="Update Profile Picture">
                            <i class="fa-solid fa-camera"></i>
                        </label>
                        <input type="file" id="avatarUpload" accept="image/*">
                    </div>
                    <div class="completion-percentage" id="completionPercentage">0%</div>
                </div>
                <h3 class="profile-name" id="profileName">Loading...</h3>
                <p class="profile-email" id="profileEmail">loading@example.com</p>
                <div class="profile-badges">
                    <span class="badge badge-seller">
                        <i class="fa-solid fa-store"></i>
                        Account
                    </span>
                    <span class="badge badge-verified" id="emailVerifiedBadge" style="display: none;">
                        <i class="fa-solid fa-envelope-circle-check"></i>
                        Email
                    </span>
                    <span class="badge badge-verified" id="phoneVerifiedBadge" style="display: none;">
                        <i class="fa-solid fa-mobile-screen-button"></i>
                        Phone
                    </span>
                    <span class="badge badge-verified" id="kycVerifiedBadge" style="display: none;">
                        <i class="fa-solid fa-id-card"></i>
                        ID
                    </span>
                </div>

                <!-- Verification Status Section -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: var(--gray-light); border-radius: 15px;">
                    <h4 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--gray-dark); font-weight: 600;">Verification Status</h4>
                    
                    <div id="emailVerificationStatus" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--white);">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fa-solid fa-envelope" style="color: var(--gray-medium);"></i>
                            <span style="font-size: 0.9rem;">Email</span>
                        </div>
                        <button onclick="sendEmailVerification()" id="emailVerifyBtn" style="background: var(--primary); color: white; border: none; padding: 0.4rem 1rem; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-weight: 600;">Verify</button>
                    </div>

                    <div id="phoneVerificationStatus" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--white);">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fa-solid fa-mobile-screen-button" style="color: var(--gray-medium);"></i>
                            <span style="font-size: 0.9rem;">Phone</span>
                        </div>
                        <button onclick="openPhoneModal()" id="phoneVerifyBtn" style="background: var(--primary); color: white; border: none; padding: 0.4rem 1rem; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-weight: 600;">Verify</button>
                    </div>

                    <div id="kycVerificationStatus" style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fa-solid fa-id-card" style="color: var(--gray-medium);"></i>
                            <span style="font-size: 0.9rem;">Government ID</span>
                        </div>
                        <button onclick="openKYCModal()" id="kycVerifyBtn" style="background: var(--primary); color: white; border: none; padding: 0.4rem 1rem; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-weight: 600;">Verify</button>
                    </div>
                </div>
            </div>

            <div class="plan-card" id="planCard">
                <div class="plan-header">
                    <div class="plan-icon">
                        <i class="fa-solid fa-crown" id="planIcon"></i>
                    </div>
                    <div class="plan-info">
                        <h3 id="planName">Free Plan</h3>
                        <p id="planDescription">Get started with basics</p>
                    </div>
                </div>
                <ul class="plan-features" id="planFeatures">
                </ul>
                <button class="upgrade-btn" id="upgradeBtn" onclick="window.location.href='pricing.html'">
                    <i class="fa-solid fa-rocket"></i>
                    Upgrade Plan
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
           <section class="settings-section">
    <div class="section-header">
        <div class="section-icon">
            <i class="fa-solid fa-user-pen"></i>
        </div>
        <div style="flex: 1;">
            <h2>Profile Settings</h2>
            <p style="color: var(--gray-medium); font-size: 0.95rem; margin-top: 0.3rem;">Complete your profile to unlock all features</p>
        </div>
        <div id="overallCompletion" class="completion-badge" style="display: none;">
            <i class="fa-solid fa-check-circle"></i>
            <span>100% Complete</span>
        </div>
    </div>

    <div class="success-message" id="successMessage">
        <i class="fa-solid fa-circle-check"></i>
        <span>Profile updated successfully!</span>
    </div>

    <!-- TAB NAVIGATION -->
    <div class="profile-tabs">
        <button class="tab-btn active" onclick="switchTab('personal')" data-tab="personal">
            <i class="fa-solid fa-user"></i>
            <span>Personal</span>
        </button>
        <button class="tab-btn" onclick="switchTab('contact')" data-tab="contact">
            <i class="fa-solid fa-phone"></i>
            <span>Contact</span>
        </button>
        <button class="tab-btn" onclick="switchTab('address')" data-tab="address">
            <i class="fa-solid fa-location-dot"></i>
            <span>Address</span>
        </button>
        <button class="tab-btn" onclick="switchTab('tax')" data-tab="tax">
            <i class="fa-solid fa-file-invoice"></i>
            <span>Tax & Legal</span>
        </button>
        <button class="tab-btn" onclick="switchTab('banking')" data-tab="banking">
            <i class="fa-solid fa-building-columns"></i>
            <span>Banking</span>
        </button>
        <button class="tab-btn" onclick="switchTab('seller')" data-tab="seller">
            <i class="fa-solid fa-star"></i>
            <span>Seller Info</span>
        </button>
    </div>

    <form id="profileForm">
        <!-- TAB 1: PERSONAL/BUSINESS INFORMATION -->
        <div class="tab-content active" id="personal-tab">
            <div class="profile-section-card">
               

                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div>
                        <h3>Personal & Business Information</h3>
                        <p>Tell us about yourself and your business</p>
                    </div>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="fullName">Full Name <span class="required-indicator">*</span></label>
                       <input type="text" class="form-input" id="fullName" placeholder="Juan Dela Cruz">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" class="form-input" id="email" disabled>
                        <div class="form-hint">Email cannot be changed</div>
                    </div>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="companyName">Company Name (Optional)</label>
                        <input type="text" class="form-input" id="companyName" placeholder="Your Company Name">
                    </div>
                    <div class="form-group">
                        <label for="businessType">Business Type <span class="required-indicator">*</span></label>
                        <select class="form-select" id="businessType">
                            <option value="">Select Business Type</option>
                            <option value="individual">Individual</option>
                            <option value="sole-proprietor">Sole Proprietor</option>
                            <option value="corporation">Corporation</option>
                            <option value="partnership">Partnership</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: CONTACT INFORMATION -->
        <div class="tab-content" id="contact-tab">
            <div class="profile-section-card">
               

                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-phone"></i>
                    </div>
                    <div>
                        <h3>Contact Information</h3>
                        <p>How can buyers and sellers reach you?</p>
                    </div>
                </div>

                <div class="help-box">
                    <p><strong><i class="fa-solid fa-lightbulb"></i> Tip:</strong> Verify your phone number to increase trust and enable SMS notifications.</p>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" class="form-input" id="phone" placeholder="+63 917 XXX XXXX" readonly style="background: var(--gray-light); cursor: not-allowed;">
                    <div class="form-hint">
                        <i class="fa-solid fa-shield-halved"></i> Verify your phone number in the left sidebar verification section
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: ADDRESS -->
        <div class="tab-content" id="address-tab">
            <div class="profile-section-card">
               

                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-location-dot"></i>
                    </div>
                    <div>
                        <h3>Address Information</h3>
                        <p>Where are you located?</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="address">Street Address <span class="required-indicator">*</span></label>
                    <input type="text" class="form-input" id="address" placeholder="123 Main Street">
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="barangay">Barangay <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="barangay" placeholder="Barangay Name">
                    </div>
                    <div class="form-group">
                        <label for="city">City <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="city" placeholder="Quezon City">
                    </div>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="province">Province <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="province" placeholder="Metro Manila">
                    </div>
                    <div class="form-group">
                        <label for="postalCode">Postal Code <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="postalCode" placeholder="1100">
                    </div>
                </div>

                <div class="form-group">
                    <label for="country">Country <span class="required-indicator">*</span></label>
                    <select class="form-select" id="country">
                        <option value="Philippines">Philippines</option>
                        <option value="US">United States</option>
                        <option value="GB">United Kingdom</option>
                        <option value="AU">Australia</option>
                        <option value="CA">Canada</option>
                        <option value="SG">Singapore</option>
                        <option value="MY">Malaysia</option>
                        <option value="ID">Indonesia</option>
                        <option value="TH">Thailand</option>
                        <option value="VN">Vietnam</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- TAB 4: TAX/LEGAL -->
        <div class="tab-content" id="tax-tab">
            <div class="profile-section-card">
              

                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-file-invoice"></i>
                    </div>
                    <div>
                        <h3>Tax & Legal Information</h3>
                        <p>Required for invoicing and compliance</p>
                    </div>
                </div>

                <div class="help-box">
                    <p><strong><i class="fa-solid fa-info-circle"></i> Why we need this:</strong> Tax information is required by law for all transactions. Your TIN will be used for invoicing and tax reporting.</p>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="taxId">Tax ID Number (TIN) <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="taxId" placeholder="XXX-XXX-XXX-XXX">
                        <div class="form-hint">Required for invoicing and tax compliance</div>
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 1rem;">VAT Registration Status</label>
                        <div class="form-checkbox-group">
                            <input type="checkbox" class="form-checkbox" id="vatRegistered">
                            <label for="vatRegistered" class="checkbox-label">
                                <i class="fa-solid fa-circle-check" style="color: var(--success);"></i>
                                I am VAT Registered
                            </label>
                        </div>
                        <div class="form-hint">Check this if your business is registered for VAT</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: BANKING INFORMATION -->
        <div class="tab-content" id="banking-tab">
            <div class="profile-section-card">
           

                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-building-columns"></i>
                    </div>
                    <div>
                        <h3>Banking Information</h3>
                        <p>For payments and refunds</p>
                    </div>
                </div>

                <div style="background: rgba(249, 115, 22, 0.1); padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem; border-left: 4px solid var(--primary);">
                    <p style="font-size: 0.95rem; color: var(--gray-dark); margin: 0;">
                        <strong><i class="fa-solid fa-shield-halved"></i> Bank-level security:</strong> Your banking information is encrypted with 256-bit SSL and used only for payments and refunds.
                    </p>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="bankName">Bank Name <span class="required-indicator">*</span></label>
                        <select class="form-select" id="bankName">
                            <option value="">Select Bank</option>
                            <option value="BDO">BDO Unibank</option>
                            <option value="BPI">Bank of the Philippine Islands (BPI)</option>
                            <option value="Metrobank">Metrobank</option>
                            <option value="UnionBank">UnionBank</option>
                            <option value="RCBC">RCBC</option>
                            <option value="PNB">Philippine National Bank (PNB)</option>
                            <option value="Landbank">Land Bank of the Philippines</option>
                            <option value="Security Bank">Security Bank</option>
                            <option value="Chinabank">Chinabank</option>
                            <option value="EastWest">EastWest Bank</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="accountType">Account Type <span class="required-indicator">*</span></label>
                        <select class="form-select" id="accountType">
                            <option value="">Select Account Type</option>
                            <option value="savings">Savings Account</option>
                            <option value="checking">Checking Account</option>
                            <option value="business">Business Account</option>
                        </select>
                    </div>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="accountName">Account Name <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="accountName" placeholder="Juan Dela Cruz">
                        <div class="form-hint">Name as it appears on your bank account</div>
                    </div>
                    <div class="form-group">
                        <label for="accountNumber">Account Number <span class="required-indicator">*</span></label>
                        <input type="text" class="form-input" id="accountNumber" placeholder="XXXXXXXXXXXX">
                        <div class="form-hint">Your bank account number</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 6: SELLER ENHANCEMENTS -->
        <div class="tab-content" id="seller-tab">
            <div class="profile-section-card">


                <div class="section-header-new">
                    <div class="section-icon-new">
                        <i class="fa-solid fa-star"></i>
                    </div>
                    <div>
                        <h3>Seller Enhancements</h3>
                        <p>Optional information to boost buyer confidence</p>
                    </div>
                </div>

                <div style="background: rgba(99, 102, 241, 0.1); padding: 1.25rem; border-radius: 12px; margin-bottom: 2rem; border-left: 4px solid var(--secondary);">
                    <p style="font-size: 0.95rem; color: var(--gray-dark); margin: 0;">
                        <strong><i class="fa-solid fa-award"></i> Stand out:</strong> Adding these optional details helps build trust with buyers and can increase your sales by up to 40%.
                    </p>
                </div>

                <div class="form-row-new">
                    <div class="form-group">
                        <label for="registrationNumber">Business Registration Number</label>
                        <input type="text" class="form-input" id="registrationNumber" placeholder="SEC/DTI Number">
                        <div class="form-hint">SEC or DTI registration number</div>
                    </div>
                    <div class="form-group">
                        <label for="supportEmail">Support Email</label>
                        <input type="email" class="form-input" id="supportEmail" placeholder="support@yourcompany.com">
                        <div class="form-hint">Separate email for customer support</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="website">Website</label>
                    <input type="url" class="form-input" id="website" placeholder="https://yourwebsite.com">
                </div>

                <div class="form-group">
                    <label for="bio">Business Description</label>
                    <textarea class="form-textarea" id="bio" maxlength="500" placeholder="Tell buyers about your business..."></textarea>
                    <div class="char-count"><span id="bioCount">0</span>/500</div>
                </div>
            </div>
        </div>

        <!-- FLOATING SAVE BUTTON -->
        <div class="floating-save-container">
            <button type="submit" class="floating-save-btn" id="saveBtn">
                <i class="fa-solid fa-floppy-disk"></i>
                Save All Changes
            </button>
        </div>
    </form>
</section>

        </main>

      <!-- RIGHT SIDEBAR NAVIGATION -->
        <aside style="width: 280px; position: sticky; top: 88px; align-self: start;">
            <div style="background: white; border-radius: 20px; padding: 1.5rem; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
                <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid var(--gray-light);">
                    <h4 style="font-size: 1.1rem; margin-bottom: 0.3rem; font-weight: 700;" id="navName"> Dashboard</h4>
                    <p style="font-size: 0.85rem; color: var(--gray-medium);">Private to you</p>
                </div>

   		<a href="profile.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: white; background: linear-gradient(135deg, var(--primary), var(--secondary)); transition: all 0.3s; font-weight: 600; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);">
                        <i class="fa-solid fa-user" style="width: 20px;"></i>
                        <span>Profile</span>
                    </a>




                <nav style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <a href="admin_sell_page.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; font-weight: 500;">
                        <i class="fa-solid fa-house" style="width: 20px; color: var(--gray-medium);"></i>
                        <span>Selling</span>
                    </a>

                    <a href="admin_buyer_page.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; font-weight: 500;">
                        <i class="fa-solid fa-list" style="width: 20px; color: var(--gray-medium);"></i>
                        <span>Buying</span>
                    </a>

                    <a href="dashboard.html?tab=sales" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; font-weight: 500;">
                        <i class="fa-solid fa-dollar-sign" style="width: 20px; color: var(--gray-medium);"></i>
                        <span>Sales</span>
                    </a>

                    <a href="dashboard.html?tab=inquiries" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; font-weight: 500;">
                        <i class="fa-solid fa-envelope" style="width: 20px; color: var(--gray-medium);"></i>
                        <span>Messages</span>
                    </a>

                 

                    <a href="pricing.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; font-weight: 500;">
                        <i class="fa-solid fa-crown" style="width: 20px; color: var(--warning);"></i>
                        <span>Upgrade Plan</span>
                    </a>

                    <a href="#" onclick="event.preventDefault(); handleSignOut();" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; border-radius: 12px; text-decoration: none; color: var(--error); transition: all 0.3s; font-weight: 500; margin-top: 1rem; border-top: 1px solid var(--gray-light);">
                        <i class="fa-solid fa-right-from-bracket" style="width: 20px;"></i>
                        <span>Sign Out</span>
                    </a>
                </nav>
            </div>
        </aside>
    </div>

    <!-- Phone Verification Modal -->
    <div id="phoneVerificationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 2.5rem; max-width: 500px; width: 90%; position: relative;">
            <button onclick="closePhoneModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-medium);">&times;</button>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <i class="fa-solid fa-mobile-screen-button" style="font-size: 2rem; color: white;"></i>
                </div>
                <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Verify Phone Number</h3>
                <p style="color: var(--gray-medium); font-size: 0.95rem;">We'll send you a verification code</p>
            </div>

            <div id="phoneInputStep">
                <div class="form-group">
                    <label>Phone Number (with country code)</label>
                    <input type="tel" id="verifyPhoneInput" class="form-input" placeholder="+63 912 345 6789" value="">
                </div>
                <div id="recaptcha-container"></div>
                <button onclick="sendPhoneOTP()" class="save-btn" style="width: 100%; margin-top: 1rem;">
                    <i class="fa-solid fa-paper-plane"></i> Send Verification Code
                </button>
            </div>

            <div id="otpInputStep" style="display: none;">
                <p style="text-align: center; margin-bottom: 1.5rem; color: var(--gray-dark);">Enter the 6-digit code sent to <strong id="sentPhoneNumber"></strong></p>
                <div class="form-group">
                    <input type="text" id="otpInput" class="form-input" placeholder="Enter 6-digit code" maxlength="6" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>
                <button onclick="verifyPhoneOTP()" class="save-btn" style="width: 100%;">
                    <i class="fa-solid fa-shield-halved"></i> Verify Code
                </button>
                <button onclick="resetPhoneVerification()" style="background: none; border: none; color: var(--primary); margin-top: 1rem; cursor: pointer; width: 100%; font-weight: 600;">Resend Code</button>
            </div>
        </div>
    </div>

   <!-- KYC Verification Modal -->
<div id="kycModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 20px; padding: 2.5rem; max-width: 500px; width: 90%; position: relative;">
        <button onclick="closeKYCModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-medium);">&times;</button>
        
        <!-- Header (Always Visible) -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--secondary), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                <i class="fa-solid fa-id-card" style="font-size: 2rem; color: white;"></i>
            </div>
            <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;" id="kycModalTitle">ID Verification</h3>
            <p style="color: var(--gray-medium); font-size: 0.95rem;" id="kycModalSubtitle">Step 1 of 3: Upload ID Front</p>
        </div>

        <!-- Progress Indicator -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 2rem; justify-content: center;">
            <div id="kycStep1Indicator" style="width: 40px; height: 4px; background: var(--secondary); border-radius: 2px; transition: all 0.3s;"></div>
            <div id="kycStep2Indicator" style="width: 40px; height: 4px; background: var(--gray-200); border-radius: 2px; transition: all 0.3s;"></div>
            <div id="kycStep3Indicator" style="width: 40px; height: 4px; background: var(--gray-200); border-radius: 2px; transition: all 0.3s;"></div>
        </div>

        <!-- Step 1: ID Front -->
        <div id="kycStep1" style="display: block;">
            <div style="background: rgba(99, 102, 241, 0.1); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid var(--secondary);">
                <p style="font-size: 0.9rem; color: var(--gray-dark); margin: 0;"><strong>Accepted IDs:</strong> Driver's License, Passport, National ID, SSS ID, UMID</p>
            </div>

            <div class="form-group">
                <div id="idFrontPreviewContainer" style="display: none; margin-bottom: 1rem;">
                    <img id="idFrontPreview" style="width: 100%; max-height: 250px; object-fit: contain; border-radius: 8px; border: 2px solid var(--success);">
                </div>
                
                <div style="border: 2px dashed var(--gray-light); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s;" id="idFrontDropzone" onclick="document.getElementById('idFrontUpload').click()">
                    <i class="fa-solid fa-cloud-arrow-up" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                    <p style="color: var(--gray-dark); font-weight: 600; margin-bottom: 0.5rem;">Click to upload ID front</p>
                    <p style="color: var(--gray-medium); font-size: 0.85rem;">PNG, JPG up to 5MB</p>
                </div>
                <input type="file" id="idFrontUpload" accept="image/*" style="display: none;">
            </div>

            <button onclick="nextKYCStep(1)" id="kycNextBtn1" class="save-btn" style="width: 100%; margin-top: 1rem;" disabled>
                Next: Upload ID Back
            </button>
        </div>

        <!-- Step 2: ID Back -->
        <div id="kycStep2" style="display: none;">
            <div class="form-group">
                <div id="idBackPreviewContainer" style="display: none; margin-bottom: 1rem;">
                    <img id="idBackPreview" style="width: 100%; max-height: 250px; object-fit: contain; border-radius: 8px; border: 2px solid var(--success);">
                </div>
                
                <div style="border: 2px dashed var(--gray-light); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s;" id="idBackDropzone" onclick="document.getElementById('idBackUpload').click()">
                    <i class="fa-solid fa-cloud-arrow-up" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                    <p style="color: var(--gray-dark); font-weight: 600; margin-bottom: 0.5rem;">Click to upload ID back</p>
                    <p style="color: var(--gray-medium); font-size: 0.85rem;">PNG, JPG up to 5MB</p>
                </div>
                <input type="file" id="idBackUpload" accept="image/*" style="display: none;">
            </div>

            <div style="display: flex; gap: 1rem;">
                <button onclick="previousKYCStep(2)" class="save-btn" style="width: 50%; background: var(--gray-light); color: var(--gray-dark);">
                    Back
                </button>
                <button onclick="nextKYCStep(2)" id="kycNextBtn2" class="save-btn" style="width: 50%;" disabled>
                    Next: Selfie
                </button>
            </div>
        </div>

        <!-- Step 3: Selfie with ID -->
        <div id="kycStep3" style="display: none;">
            <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid var(--warning);">
                <p style="font-size: 0.85rem; color: var(--gray-dark); margin: 0;"><strong>📸 Tips:</strong> Hold your ID next to your face. Ensure both your face and ID are clearly visible in good lighting.</p>
            </div>

            <div class="form-group">
                <div id="selfiePreviewContainer" style="display: none; margin-bottom: 1rem;">
                    <img id="selfiePreview" style="width: 100%; max-height: 250px; object-fit: contain; border-radius: 8px; border: 2px solid var(--success);">
                </div>
                
                <div style="border: 2px dashed var(--gray-light); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: all 0.3s;" id="selfieDropzone" onclick="document.getElementById('selfieUpload').click()">
                    <i class="fa-solid fa-camera" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                    <p style="color: var(--gray-dark); font-weight: 600; margin-bottom: 0.5rem;">Click to upload selfie</p>
                    <p style="color: var(--gray-medium); font-size: 0.85rem;">Hold your ID next to your face</p>
                </div>
                <input type="file" id="selfieUpload" accept="image/*" style="display: none;">
            </div>

            <div style="display: flex; gap: 1rem;">
                <button onclick="previousKYCStep(3)" class="save-btn" style="width: 40%; background: var(--gray-light); color: var(--gray-dark);">
                    Back
                </button>
                <button onclick="submitKYCVerification()" id="kycSubmitBtn" class="save-btn" style="width: 60%;" disabled>
                    <i class="fa-solid fa-paper-plane"></i> Submit
                </button>
            </div>
        </div>

        <!-- Upload Progress -->
        <div id="kycUploadProgress" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                <span id="kycUploadStatus">Uploading...</span>
                <span id="kycUploadPercentage">0%</span>
            </div>
            <div style="width: 100%; height: 6px; background: var(--gray-200); border-radius: 6px; overflow: hidden;">
                <div id="kycProgressBar" style="height: 100%; background: var(--primary); transition: width 0.3s; width: 0%;"></div>
            </div>
        </div>
    </div>
</div>





        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, updateProfile, deleteUser, sendEmailVerification as firebaseSendEmailVerification, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
       
        // You would typically move this to a separate config file
        const firebaseConfig = {
            apiKey: "AIzaSyD3PQ5oWrzAXOHnb7wrmpRhL9DWIB7w9rE",
            authDomain: "systemly-db.firebaseapp.com",
            projectId: "systemly-db",
            storageBucket: "systemly-db.firebasestorage.app",
            messagingSenderId: "32599486733",
            appId: "1:32599486733:web:16d34643c8f920a6fd8044"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const CLOUDINARY_CLOUD_NAME = 'dxv11m11i';
        const CLOUDINARY_UPLOAD_PRESET = 'systemly_uploads';
        let uploadedAvatarURL = null;

        let kycCurrentStep = 1;
        let kycUploadedFiles = {
            idFront: null,
            idBack: null,
            selfie: null
        };


        let currentUser = null;
        let userData = null;
        let confirmationResult = null;
        const storage = getStorage(app);

        // ==========================================
        // EMAIL VERIFICATION
        // ==========================================
      // ==========================================
        // EMAIL VERIFICATION
        // ==========================================
        window.sendEmailVerification = async function() {
            if (!currentUser) return;
            
            const btn = document.getElementById('emailVerifyBtn');
            const originalText = btn.innerHTML;
            
            // Check if already verified
            if (currentUser.emailVerified) {
                alert('✅ Your email is already verified!');
                return;
            }
            
            // Disable button and show loading
            btn.innerHTML = '<span class="spinner"></span> Sending...';
            btn.disabled = true;
            
            try {
                await firebaseSendEmailVerification(currentUser);
                
                alert('✉️ Verification email sent! Please check your inbox and spam folder.\n\nAfter verifying, refresh this page to see the update.');
                
                // Update button to show "Check Email"
                btn.textContent = '📧 Check Email';
                btn.style.background = 'var(--warning)';
                btn.disabled = false;
                
                // Store the time we sent the email to prevent spam
                sessionStorage.setItem('lastEmailVerificationSent', Date.now().toString());
                
            } catch (error) {
                console.error('Error sending email verification:', error);
                
                let errorMessage = 'Failed to send verification email.';
                
                if (error.code === 'auth/too-many-requests') {
                    errorMessage = '⚠️ Too many requests. Please wait a few minutes before trying again.\n\nIf you already sent a verification email, please check your inbox (and spam folder).';
                } else if (error.code === 'auth/user-token-expired') {
                    errorMessage = 'Session expired. Please sign out and sign in again.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Network error. Please check your internet connection.';
                } else {
                    errorMessage = error.message || errorMessage;
                }
                
                alert(errorMessage);
                
                // Restore button
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        // Check if user just verified their email
        window.addEventListener('focus', async () => {
            if (currentUser && !currentUser.emailVerified) {
                try {
                    await currentUser.reload();
                    if (currentUser.emailVerified) {
                        alert('✅ Email verified successfully!');
                        await loadUserData(currentUser);
                    }
                } catch (error) {
                    console.error('Error reloading user:', error);
                }
            }
        });

        // ==========================================
        // PHONE VERIFICATION
        // ==========================================
      window.openPhoneModal = function() {
            const phone = document.getElementById('phone').value;
            document.getElementById('verifyPhoneInput').value = phone || '+63';
            document.getElementById('phoneVerificationModal').style.display = 'flex';
            
            // Initialize reCAPTCHA if not already
            if (!window.recaptchaVerifier) {
                setTimeout(() => {
                    try {
                        window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
                            'size': 'normal',
                            'callback': (response) => {
                                console.log('reCAPTCHA verified');
                            }
                        });
                        window.recaptchaVerifier.render();
                    } catch (error) {
                        console.error('Error initializing reCAPTCHA:', error);
                    }
                }, 100);
            }
        }

        window.closePhoneModal = function() {
            document.getElementById('phoneVerificationModal').style.display = 'none';
        }

        window.sendPhoneOTP = async function() {
            const phoneNumber = document.getElementById('verifyPhoneInput').value.trim();
            
            if (!phoneNumber || phoneNumber.length < 10) {
                alert('Please enter a valid phone number with country code (e.g., +639123456789)');
                return;
            }

            try {
                const appVerifier = window.recaptchaVerifier;
                confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, appVerifier);
                
                // Switch to OTP input
                document.getElementById('phoneInputStep').style.display = 'none';
                document.getElementById('otpInputStep').style.display = 'block';
                document.getElementById('sentPhoneNumber').textContent = phoneNumber;
                
                console.log('SMS sent successfully');
            } catch (error) {
                console.error('Error sending SMS:', error);
                alert('Failed to send verification code: ' + error.message);
                window.recaptchaVerifier.clear();
                window.recaptchaVerifier = null;
            }
        }

        window.verifyPhoneOTP = async function() {
            const otp = document.getElementById('otpInput').value.trim();
            
            if (!otp || otp.length !== 6) {
                alert('Please enter the 6-digit code');
                return;
            }

            try {
                const result = await confirmationResult.confirm(otp);
                console.log('Phone verified successfully:', result);
                
                // Update Firestore
                const phoneNumber = document.getElementById('verifyPhoneInput').value;
                const userDocRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    'verification.phoneVerified': true,
                    'verification.phoneNumber': phoneNumber,
                    'verification.phoneVerifiedAt': new Date().toISOString()
                });
                
                alert('✅ Phone number verified successfully!');
                closePhoneModal();
                await loadUserData(currentUser);
                
            } catch (error) {
                console.error('Error verifying OTP:', error);
                alert('Invalid verification code. Please try again.');
            }
        }

        window.resetPhoneVerification = function() {
            document.getElementById('phoneInputStep').style.display = 'block';
            document.getElementById('otpInputStep').style.display = 'none';
            document.getElementById('otpInput').value = '';
            window.recaptchaVerifier.clear();
            window.recaptchaVerifier = null;
        }

        // ==========================================
      // ==========================================
        // KYC VERIFICATION
        // ==========================================
   

        window.openKYCModal = function() {
            // Reset modal to step 1
            kycCurrentStep = 1;
            kycUploadedFiles = { idFront: null, idBack: null, selfie: null };
            resetKYCModal();
            document.getElementById('kycModal').style.display = 'flex';
        }

        window.closeKYCModal = function() {
            document.getElementById('kycModal').style.display = 'none';
            resetKYCModal();
        }

        function resetKYCModal() {
            // Hide all steps
            document.getElementById('kycStep1').style.display = 'none';
            document.getElementById('kycStep2').style.display = 'none';
            document.getElementById('kycStep3').style.display = 'none';
            
            // Show step 1
            document.getElementById('kycStep1').style.display = 'block';
            
            // Reset progress indicators
            document.getElementById('kycStep1Indicator').style.background = 'var(--secondary)';
            document.getElementById('kycStep2Indicator').style.background = 'var(--gray-200)';
            document.getElementById('kycStep3Indicator').style.background = 'var(--gray-200)';
            
            // Reset title
            document.getElementById('kycModalTitle').textContent = 'ID Verification';
            document.getElementById('kycModalSubtitle').textContent = 'Step 1 of 3: Upload ID Front';
            
            // Reset previews
            document.getElementById('idFrontPreviewContainer').style.display = 'none';
            document.getElementById('idBackPreviewContainer').style.display = 'none';
            document.getElementById('selfiePreviewContainer').style.display = 'none';
            
            // Reset file inputs
            document.getElementById('idFrontUpload').value = '';
            document.getElementById('idBackUpload').value = '';
            document.getElementById('selfieUpload').value = '';
            
            // Disable buttons
            document.getElementById('kycNextBtn1').disabled = true;
            document.getElementById('kycNextBtn2').disabled = true;
            document.getElementById('kycSubmitBtn').disabled = true;
        }

        window.nextKYCStep = function(currentStep) {
            kycCurrentStep = currentStep + 1;
            
            // Hide current step
            document.getElementById(`kycStep${currentStep}`).style.display = 'none';
            
            // Show next step
            document.getElementById(`kycStep${kycCurrentStep}`).style.display = 'block';
            
            // Update progress indicator
            document.getElementById(`kycStep${kycCurrentStep}Indicator`).style.background = 'var(--secondary)';
            
            // Update title
            const titles = {
                2: { title: 'ID Verification', subtitle: 'Step 2 of 3: Upload ID Back' },
                3: { title: 'ID Verification', subtitle: 'Step 3 of 3: Upload Selfie' }
            };
            
            document.getElementById('kycModalTitle').textContent = titles[kycCurrentStep].title;
            document.getElementById('kycModalSubtitle').textContent = titles[kycCurrentStep].subtitle;
        }

        window.previousKYCStep = function(currentStep) {
            kycCurrentStep = currentStep - 1;
            
            // Hide current step
            document.getElementById(`kycStep${currentStep}`).style.display = 'none';
            
            // Show previous step
            document.getElementById(`kycStep${kycCurrentStep}`).style.display = 'block';
            
            // Update progress indicator
            document.getElementById(`kycStep${currentStep}Indicator`).style.background = 'var(--gray-200)';
            
            // Update title
            const titles = {
                1: { title: 'ID Verification', subtitle: 'Step 1 of 3: Upload ID Front' },
                2: { title: 'ID Verification', subtitle: 'Step 2 of 3: Upload ID Back' }
            };
            
            document.getElementById('kycModalTitle').textContent = titles[kycCurrentStep].title;
            document.getElementById('kycModalSubtitle').textContent = titles[kycCurrentStep].subtitle;
        }

        // Image upload handlers
        document.getElementById('idFrontUpload').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                handleKYCImageUpload(e.target.files[0], 'idFront', 'idFrontPreview', 'kycNextBtn1');
            }
        });

        document.getElementById('idBackUpload').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                handleKYCImageUpload(e.target.files[0], 'idBack', 'idBackPreview', 'kycNextBtn2');
            }
        });

        document.getElementById('selfieUpload').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                handleKYCImageUpload(e.target.files[0], 'selfie', 'selfiePreview', 'kycSubmitBtn');
            }
        });

        async function handleKYCImageUpload(file, type, previewId, buttonId) {
            // Validate file
            if (file.size > 5 * 1024 * 1024) {
                alert('File is too large. Maximum size is 5MB.');
                return;
            }

            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file.');
                return;
            }

            // Show preview immediately
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                const container = document.getElementById(previewId + 'Container');
                preview.src = e.target.result;
                container.style.display = 'block';
            }
            reader.readAsDataURL(file);

            // Upload to Cloudinary
            await uploadKYCToCloudinary(file, type, buttonId);
        }

        async function uploadKYCToCloudinary(file, type, buttonId) {
            const uploadProgress = document.getElementById('kycUploadProgress');
            const uploadStatus = document.getElementById('kycUploadStatus');
            const uploadPercentage = document.getElementById('kycUploadPercentage');
            const progressBar = document.getElementById('kycProgressBar');

            uploadProgress.style.display = 'block';
            uploadStatus.textContent = `Uploading ${type}...`;
            uploadPercentage.textContent = '0%';
            progressBar.style.width = '0%';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('folder', `systemly-kyc/${currentUser.uid}`);

            try {
                const xhr = new XMLHttpRequest();

                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        uploadPercentage.textContent = percentComplete + '%';
                        progressBar.style.width = percentComplete + '%';
                    }
                });

                xhr.addEventListener('load', () => {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        kycUploadedFiles[type] = response.secure_url;
                        
                        uploadStatus.textContent = 'Upload complete!';
                        uploadPercentage.textContent = '100%';
                        
                        // Enable next button
                        document.getElementById(buttonId).disabled = false;
                        
                        setTimeout(() => {
                            uploadProgress.style.display = 'none';
                        }, 1000);
                    } else {
                        throw new Error(`Upload failed with status ${xhr.status}`);
                    }
                });

                xhr.addEventListener('error', () => {
                    console.error('Upload error');
                    alert(`Failed to upload ${type}. Please try again.`);
                    uploadProgress.style.display = 'none';
                });

                xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`);
                xhr.send(formData);

            } catch (error) {
                console.error('Error uploading:', error);
                alert(`Failed to upload ${type}. Please try again.`);
                uploadProgress.style.display = 'none';
            }
        }


       window.submitKYCVerification = async function() {
            // Check if all files are uploaded
            if (!kycUploadedFiles.idFront || !kycUploadedFiles.idBack || !kycUploadedFiles.selfie) {
                alert('❌ Please upload all required documents');
                return;
            }

            const submitBtn = document.getElementById('kycSubmitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="spinner"></span> Submitting...';
            submitBtn.disabled = true;

            try {
                // Update Firestore with Cloudinary URLs
                const userDocRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    'verification.kycStatus': 'pending',
                    'verification.kycSubmittedAt': new Date().toISOString(),
                    'verification.kycDocuments': {
                        idFront: kycUploadedFiles.idFront,
                        idBack: kycUploadedFiles.idBack,
                        selfie: kycUploadedFiles.selfie
                    }
                });

                alert('✅ KYC documents submitted successfully! Our team will review within 24-48 hours.');
                closeKYCModal();
                await loadUserData(currentUser);
                
            } catch (error) {
                console.error('Error submitting KYC:', error);
                alert('Failed to submit verification: ' + error.message);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // ==========================================
        // UPDATE VERIFICATION STATUS UI
        // ==========================================
        function updateVerificationUI(data) {
            const verification = data.verification || {};
            
            // Email Verification
            if (currentUser.emailVerified) {
                document.getElementById('emailVerifiedBadge').style.display = 'flex';
                document.getElementById('emailVerifyBtn').textContent = '✓ Verified';
                document.getElementById('emailVerifyBtn').style.background = 'var(--success)';
                document.getElementById('emailVerifyBtn').disabled = true;
            } else {
                document.getElementById('emailVerifyBtn').textContent = 'Verify';
                document.getElementById('emailVerifyBtn').style.background = 'var(--primary)';
                document.getElementById('emailVerifyBtn').disabled = false;
            }
            
            // Phone Verification
            if (verification.phoneVerified) {
                document.getElementById('phoneVerifiedBadge').style.display = 'flex';
                document.getElementById('phoneVerifyBtn').textContent = '✓ Verified';
                document.getElementById('phoneVerifyBtn').style.background = 'var(--success)';
                document.getElementById('phoneVerifyBtn').disabled = true;
                document.getElementById('phone').value = verification.phoneNumber || '';
            } else {
                document.getElementById('phoneVerifyBtn').textContent = 'Verify';
                document.getElementById('phoneVerifyBtn').style.background = 'var(--primary)';
                document.getElementById('phoneVerifyBtn').disabled = false;
            }
            
            // KYC Verification
            const kycStatus = verification.kycStatus || 'none';
            const kycBtn = document.getElementById('kycVerifyBtn');
            
            if (kycStatus === 'approved') {
                document.getElementById('kycVerifiedBadge').style.display = 'flex';
                kycBtn.textContent = '✓ Verified';
                kycBtn.style.background = 'var(--success)';
                kycBtn.disabled = true;
            } else if (kycStatus === 'pending') {
                kycBtn.textContent = '⏳ Pending';
                kycBtn.style.background = 'var(--warning)';
                kycBtn.disabled = true;
            } else if (kycStatus === 'rejected') {
                kycBtn.textContent = '✗ Retry';
                kycBtn.style.background = 'var(--error)';
                kycBtn.disabled = false;
            } else {
                kycBtn.textContent = 'Verify';
                kycBtn.style.background = 'var(--primary)';
                kycBtn.disabled = false;
            }
        }

        // ==========================================
        // UPDATE PROFILE COMPLETION WITH VERIFICATIONS
        // ==========================================
        function calculateProfileCompletionWithVerifications(data) {
    let completedFields = 0;
    const verification = data.verification || {};
    const profile = data.profile || {};
    const banking = data.banking || {};
    
    const completionCriteria = [
        // Required fields (higher weight)
        { check: !!data.name && data.name.trim().length > 2, weight: 1 },
        { check: !!data.businessType, weight: 1 },
        { check: !!data.taxId, weight: 1.5 },
        { check: !!profile.address, weight: 1 },
        { check: !!profile.barangay, weight: 0.5 },
        { check: !!profile.city, weight: 0.5 },
        { check: !!profile.province, weight: 0.5 },
        { check: !!profile.postalCode, weight: 0.5 },
        { check: !!profile.country, weight: 0.5 },
        { check: !!banking.bankName, weight: 1 },
        { check: !!banking.accountName, weight: 1 },
        { check: !!banking.accountNumber, weight: 1 },
        { check: !!banking.accountType, weight: 1 },
        
        // Verifications (highest weight)
        { check: !!currentUser.emailVerified, weight: 1.5 },
        { check: !!verification.phoneVerified, weight: 1.5 },
        { check: verification.kycStatus === 'approved', weight: 2 },
        
        // Optional but valuable
        { check: !!currentUser.photoURL, weight: 1 },
        { check: !!profile.phone, weight: 0.5 },
        { check: !!profile.bio && profile.bio.trim().length >= 20, weight: 1 },
        { check: !!data.companyName, weight: 0.5 },
        { check: !!profile.website, weight: 0.5 }
    ];
    
    const totalWeight = 18;
    completedFields = completionCriteria.filter(c => c.check).reduce((sum, c) => sum + c.weight, 0);
    const percentage = Math.min(100, Math.round((completedFields / totalWeight) * 100));
    
    updateCompletionDisplay(percentage);
    return percentage;
}



























        // Plan configurations
        const planConfigs = {
            free: {
                name: 'Free Plan',
                description: 'Get started with basics',
                icon: 'fa-rocket',
                colorClass: 'plan-free',
                upgradeText: 'Upgrade Plan',
                features: [
                    { text: '1 listing per month', enabled: true },
                    { text: 'Basic analytics', enabled: true },
                    { text: 'Email support', enabled: true },
                    { text: 'Priority support', enabled: false },
                    { text: 'Advanced analytics', enabled: false },
                    { text: 'Unlimited listings', enabled: false }
                ]
            },
            basic: {
                name: 'Basic Plan',
                description: 'Perfect for growing businesses',
                icon: 'fa-star',
                colorClass: 'plan-basic',
                upgradeText: 'Upgrade to Premium',
                features: [
                    { text: '3 listings per month', enabled: true },
                    { text: 'Advanced analytics', enabled: true },
                    { text: 'Priority email support', enabled: true },
                    { text: 'Featured listings', enabled: true },
                    { text: '24/7 phone support', enabled: false },
                    { text: 'Unlimited listings', enabled: false }
                ]
            },
            premium: {
                name: 'Premium Plan',
                description: 'Unlimited everything',
                icon: 'fa-crown',
                colorClass: 'plan-premium',
                upgradeText: 'Current Plan',
                features: [
                    { text: 'Unlimited listings', enabled: true },
                    { text: 'Advanced analytics', enabled: true },
                    { text: '24/7 priority support', enabled: true },
                    { text: 'Featured listings', enabled: true },
                    { text: 'Dedicated account manager', enabled: true },
                    { text: 'Custom branding', enabled: true }
                ]
            }
        };

        // ==========================================
        // AUTHENTICATION & DATA LOADING
        // ==========================================

       onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData(user);
                
                // Check if email was recently verified
                if (user.emailVerified) {
                    const wasUnverified = sessionStorage.getItem('emailWasUnverified');
                    if (wasUnverified === 'true') {
                        sessionStorage.removeItem('emailWasUnverified');
                        alert('✅ Email verified successfully! Your profile has been updated.');
                    }
                } else {
                    sessionStorage.setItem('emailWasUnverified', 'true');
                }
            } else {
                // Redirect unauthenticated users
                window.location.href = 'login.html';
            }
        });

        async function loadUserData(user) {
            try {
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    const currentPlan = userData.subscriptionPlan || 'free';
                    
                    populateProfileData(user, userData);
                    updatePlanDisplay(currentPlan);
                    updateVerificationUI(userData);
                    calculateProfileCompletionWithVerifications(userData);
                    
                    // Update right sidebar name only
                    const navName = document.getElementById('navName');
                    if (navName) {
                        const userName = userData.name || user.displayName || 'User';
                        navName.textContent = `${userName}'s Dashboard`;
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // ==========================================
        // PROFILE POPULATION & COMPLETION LOGIC
        // ==========================================

       function populateProfileData(user, data) {
    const profile = data.profile || {};
    const banking = data.banking || {};
    
    document.getElementById('profileName').textContent = data.name || user.displayName || 'User';
    document.getElementById('profileEmail').textContent = user.email;
    
    const avatar = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.name || user.email)}&size=100&background=F97316&color=fff`;
    document.getElementById('profileAvatar').src = avatar;
    
    // Personal/Business Information
    document.getElementById('fullName').value = data.name || '';
    document.getElementById('email').value = user.email;
    document.getElementById('companyName').value = data.companyName || '';
    document.getElementById('businessType').value = data.businessType || '';
    
    // Contact
    document.getElementById('phone').value = profile.phone || '';
    
    // Address
    document.getElementById('address').value = profile.address || '';
    document.getElementById('barangay').value = profile.barangay || '';
    document.getElementById('city').value = profile.city || '';
    document.getElementById('province').value = profile.province || profile.state || '';
    document.getElementById('postalCode').value = profile.postalCode || '';
    document.getElementById('country').value = profile.country || 'Philippines';
    
    // Tax/Legal
    document.getElementById('taxId').value = data.taxId || '';
    document.getElementById('vatRegistered').checked = data.vatRegistered || false;
    
    // Banking
    document.getElementById('bankName').value = banking.bankName || '';
    document.getElementById('accountType').value = banking.accountType || '';
    document.getElementById('accountName').value = banking.accountName || '';
    document.getElementById('accountNumber').value = banking.accountNumber || '';
    
    // Seller Enhancements (Optional)
    document.getElementById('registrationNumber').value = data.registrationNumber || '';
    document.getElementById('supportEmail').value = data.supportEmail || '';
    document.getElementById('website').value = profile.website || '';
    document.getElementById('bio').value = profile.bio || '';
    
    updateCharCount();
    
    // Show seller enhancements if user has seller role
    if (data.role === 'seller' || data.isSeller) {
        document.getElementById('sellerEnhancementsSection').style.display = 'block';
    }
}
        





        function updateCompletionDisplay(percentage) {
            const radius = 60;
            const circumference = 2 * Math.PI * radius; // Approx 377
            const offset = circumference - (percentage / 100) * circumference;
            
            const circle = document.getElementById('completionCircle');
            const percentageText = document.getElementById('completionPercentage');

            percentageText.textContent = `${percentage}%`;
            circle.style.strokeDashoffset = offset;

            // Use the success color if 100% complete
            if (percentage === 100) {
                circle.style.stroke = 'var(--success)';
                percentageText.style.color = 'var(--success)';
            } else {
                // Re-apply the gradient for less than 100%
                circle.style.stroke = 'url(#gradient)';
                percentageText.style.color = 'var(--primary)';
            }
        }

        function updateCharCount() {
            const bio = document.getElementById('bio');
            document.getElementById('bioCount').textContent = bio.value.length;
        }


        // ==========================================
        // PLAN DISPLAY LOGIC
        // ==========================================

        function updatePlanDisplay(plan) {
            const config = planConfigs[plan] || planConfigs.free;
            const planCard = document.getElementById('planCard');
            const planFeaturesList = document.getElementById('planFeatures');
            const upgradeBtn = document.getElementById('upgradeBtn');
            const planIcon = document.getElementById('planIcon');

            // Update plan card classes for border and icon color styling
            planCard.className = `plan-card ${config.colorClass}`;
            
            // Update plan info
            document.getElementById('planName').textContent = config.name;
            document.getElementById('planDescription').textContent = config.description;
            planIcon.className = `fa-solid ${config.icon}`;
            
            // Update features list
            const featuresHTML = config.features.map(feature => `
                <li class="${feature.enabled ? '' : 'disabled'}">
                    <i class="fa-solid ${feature.enabled ? 'fa-circle-check' : 'fa-circle-xmark'}"></i>
                    ${feature.text}
                </li>
            `).join('');
            planFeaturesList.innerHTML = featuresHTML;

            // Update button
            upgradeBtn.innerHTML = `<i class="fa-solid ${plan === 'premium' ? 'fa-medal' : 'fa-rocket'}"></i> ${config.upgradeText}`;
            if (plan === 'premium') {
                upgradeBtn.classList.add('current');
                upgradeBtn.disabled = true;
            } else {
                upgradeBtn.classList.remove('current');
                upgradeBtn.disabled = false;
            }
        }

        // ==========================================
        // FORM SUBMISSION AND HANDLERS
        // ==========================================

        const profileForm = document.getElementById('profileForm');
        const bioTextarea = document.getElementById('bio');
        const saveBtn = document.getElementById('saveBtn');
        const successMessage = document.getElementById('successMessage');

        profileForm.addEventListener('submit', handleProfileUpdate);
        bioTextarea.addEventListener('input', updateCharCount);

        // Basic avatar update placeholder
      // Avatar upload with Cloudinary
        document.getElementById('avatarUpload').addEventListener('change', async function(e) {
            if (e.target.files && e.target.files[0]) {
                const file = e.target.files[0];
                
                // Validate file
                if (file.size > 5 * 1024 * 1024) {
                    alert('Image is too large. Maximum size is 5MB.');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Please upload an image file.');
                    return;
                }
                
                // Show preview immediately
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileAvatar').src = e.target.result;
                };
                reader.readAsDataURL(file);
                
                // Show uploading status
                saveBtn.innerHTML = '<span class="spinner"></span> Uploading avatar...';
                saveBtn.disabled = true;
                
                // Upload to Cloudinary
                await uploadAvatarToCloudinary(file);
            }
        });
        
        // Function to upload avatar to Cloudinary
        async function uploadAvatarToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('folder', `systemly-avatars/${currentUser.uid}`);

            try {
                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Upload failed');
                }

                const data = await response.json();
                uploadedAvatarURL = data.secure_url;
                
                // Update Firebase Auth profile immediately
                await updateProfile(currentUser, {
                    photoURL: uploadedAvatarURL
                });
                
                // Update Firestore
                const userDocRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    photoURL: uploadedAvatarURL,
                    updatedAt: new Date().toISOString()
                });
                
                // Show success
                saveBtn.innerHTML = '<i class="fa-solid fa-check"></i> Avatar Updated!';
                saveBtn.style.background = 'var(--success)';
                
                setTimeout(() => {
                    saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';
                    saveBtn.style.background = '';
                    saveBtn.disabled = false;
                }, 2000);
                
                // Recalculate profile completion
                await loadUserData(currentUser);
                
            } catch (error) {
                console.error('Error uploading avatar:', error);
                alert('Failed to upload avatar. Please try again.');
                saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';
                saveBtn.disabled = false;
            }
        }
        
async function handleProfileUpdate(e) {
    e.preventDefault();
    
    // Manually validate visible required fields
    const requiredFields = [
        { id: 'fullName', name: 'Full Name', tab: 'personal' },
        { id: 'businessType', name: 'Business Type', tab: 'personal' },
        { id: 'address', name: 'Street Address', tab: 'address' },
        { id: 'barangay', name: 'Barangay', tab: 'address' },
        { id: 'city', name: 'City', tab: 'address' },
        { id: 'province', name: 'Province', tab: 'address' },
        { id: 'postalCode', name: 'Postal Code', tab: 'address' },
        { id: 'country', name: 'Country', tab: 'address' },
        { id: 'taxId', name: 'Tax ID (TIN)', tab: 'tax' },
        { id: 'bankName', name: 'Bank Name', tab: 'banking' },
        { id: 'accountType', name: 'Account Type', tab: 'banking' },
        { id: 'accountName', name: 'Account Name', tab: 'banking' },
        { id: 'accountNumber', name: 'Account Number', tab: 'banking' }
    ];

    // Check each required field
    for (const field of requiredFields) {
        const element = document.getElementById(field.id);
        const value = element.value.trim();
        
        if (!value) {
            // Switch to the tab containing the empty field
            switchTab(field.tab);
            
            // Focus on the field
            setTimeout(() => {
                element.focus();
                element.style.borderColor = 'var(--error)';
                setTimeout(() => {
                    element.style.borderColor = '';
                }, 2000);
            }, 300);
            
            alert(`❌ Please fill in: ${field.name}\n\nTab: ${field.tab.charAt(0).toUpperCase() + field.tab.slice(1)}`);
            return;
        }
    }
    
    saveBtn.innerHTML = '<span class="spinner"></span> Saving...';
    saveBtn.disabled = true;

    const fullName = document.getElementById('fullName').value;
    const companyName = document.getElementById('companyName').value;
    const businessType = document.getElementById('businessType').value;
    const phone = document.getElementById('phone').value;
    const address = document.getElementById('address').value;
    const barangay = document.getElementById('barangay').value;
    const city = document.getElementById('city').value;
    const province = document.getElementById('province').value;
    const postalCode = document.getElementById('postalCode').value;
    const country = document.getElementById('country').value;
    const taxId = document.getElementById('taxId').value;
    const vatRegistered = document.getElementById('vatRegistered').checked;
    const bankName = document.getElementById('bankName').value;
    const accountType = document.getElementById('accountType').value;
    const accountName = document.getElementById('accountName').value;
    const accountNumber = document.getElementById('accountNumber').value;
    const registrationNumber = document.getElementById('registrationNumber').value;
    const supportEmail = document.getElementById('supportEmail').value;
    const website = document.getElementById('website').value;
    const bio = document.getElementById('bio').value;

    try {
        // Update Firebase Auth
        await updateProfile(currentUser, {
            displayName: fullName
        });

        // Update Firestore Document with ALL new fields
        const userDocRef = doc(db, 'users', currentUser.uid);
        await updateDoc(userDocRef, {
            name: fullName,
            companyName: companyName,
            businessType: businessType,
            taxId: taxId,
            vatRegistered: vatRegistered,
            registrationNumber: registrationNumber,
            supportEmail: supportEmail,
            profile: {
                phone: phone,
                address: address,
                barangay: barangay,
                city: city,
                province: province,
                state: province,
                postalCode: postalCode,
                country: country,
                location: `${city}, ${province}, ${country}`,
                bio: bio,
                company: companyName,
                website: website,
                verified: userData.profile?.verified || false
            },
            banking: {
                bankName: bankName,
                accountName: accountName,
                accountNumber: accountNumber,
                accountType: accountType
            },
            profileCompleted: true,
            updatedAt: new Date().toISOString()
        }, { merge: true });

        // Reload and update UI
        await loadUserData(currentUser);

        // Display success
        successMessage.classList.add('show');
        setTimeout(() => {
            successMessage.classList.remove('show');
        }, 4000);

    } catch (error) {
        console.error("Error updating profile: ", error);
        alert("Failed to update profile. Please try again. Error: " + error.message);
    } finally {
        saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save All Changes';
        saveBtn.disabled = false;
    }
}
        // Global function for account deletion (used in the Danger Zone)
        window.deleteAccount = async function() {
            if (!confirm('Are you absolutely sure you want to delete your account? This action is irreversible.')) {
                return;
            }

            try {
                // 1. Delete Firestore data
                const userDocRef = doc(db, 'users', currentUser.uid);
                await deleteDoc(userDocRef);

                // 2. Delete the user from Firebase Auth
                await deleteUser(currentUser);

                // 3. Redirect to login/homepage
                alert('Your account has been successfully deleted.');
                window.location.href = 'login.html';

            } catch (error) {
                console.error("Error deleting account: ", error);
                // If the error is 'auth/requires-recent-login', inform the user.
                if (error.code === 'auth/requires-recent-login') {
                    alert('Security Error: Please log out and log back in to perform this security-sensitive action.');
                } else {
                    alert("Account deletion failed. Error: " + error.message);
                }
            }
        }

// Global sign out function for right sidebar
        const handleSignOut = async function() {
            if (confirm('Are you sure you want to sign out?')) {
                try {
                    await auth.signOut();
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Error signing out:', error);
                    alert('Failed to sign out');
                }
            }
        }
        
        // Make it globally accessible
        window.handleSignOut = handleSignOut;



// ==========================================
// TAB SWITCHING FUNCTIONALITY
// ==========================================
window.switchTab = function(tabName) {
    // Remove active class from all tabs and content
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    // Add active class to clicked tab and corresponding content
    const tabBtn = document.querySelector(`[data-tab="${tabName}"]`);
    const tabContent = document.getElementById(`${tabName}-tab`);
    
    if (tabBtn) tabBtn.classList.add('active');
    if (tabContent) tabContent.classList.add('active');
    
    // Scroll to top of page smoothly
    window.scrollTo({ 
        top: document.querySelector('.settings-section').offsetTop - 100, 
        behavior: 'smooth' 
    });
}

function updateTabCompletionIndicators() {
    const tabs = [
        { name: 'personal', fields: ['fullName', 'businessType'] },
        { name: 'contact', fields: ['phone'] },
        { name: 'address', fields: ['address', 'barangay', 'city', 'province', 'postalCode', 'country'] },
        { name: 'tax', fields: ['taxId'] },
        { name: 'banking', fields: ['bankName', 'accountType', 'accountName', 'accountNumber'] },
        { name: 'seller', fields: [] } // Optional fields
    ];

    tabs.forEach(tab => {
        const tabBtn = document.querySelector(`[data-tab="${tab.name}"]`);
        if (!tabBtn) return;

        // Remove existing classes
        tabBtn.classList.remove('complete', 'incomplete');

        // Check if all required fields are filled
        const allFilled = tab.fields.every(fieldId => {
            const element = document.getElementById(fieldId);
            return element && element.value.trim() !== '';
        });

        if (tab.fields.length > 0) {
            tabBtn.classList.add(allFilled ? 'complete' : 'incomplete');
        }
    });
}

// Call this when form inputs change
document.getElementById('profileForm').addEventListener('input', updateTabCompletionIndicators);
document.getElementById('profileForm').addEventListener('change', updateTabCompletionIndicators);



    </script>
</body>
</html>
