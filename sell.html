<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Your System - Systemly</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
    --primary: #F97316;
    --primary-dark: #EA580C;
    --secondary: #6366F1;
    --accent: #14B8A6;
    --bg: #FFF7ED;
    --white: #FFFFFF;
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-400: #9CA3AF;
    --gray-500: #6B7280;
    --gray-600: #4B5563;
    --gray-700: #374151;
    --gray-800: #1F2937;
    --gray-900: #111827;
    --success: #10B981;
    --error: #EF4444;
    --warning: #F59E0B;
    --text: #1F2937;
    --border: #E5E7EB;
}

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            width: 100%;
            background: var(--white);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            padding: 0 5%;
        }

        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 72px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9375rem;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .sign-in-btn {
            background: var(--primary);
            color: var(--white);
            padding: 0.625rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sign-in-btn:hover {
            background: var(--primary-dark);
        }

        .user-profile {
            display: none;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .user-profile.logged-in {
            display: flex;
        }

        .user-profile:hover {
            background: var(--gray-50);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--border);
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        /* Header Section (Like Flippa) */
        .page-header {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 2rem 5%;
        }

        .page-header-content {
            max-width: 1280px;
            margin: 0 auto;
        }

        .page-header h1 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            font-size: 1rem;
            color: var(--gray-600);
        }

        /* Main Layout (Two Column like Flippa) */
        .main-container {
    max-width: 1280px;
    margin: 2rem auto;
    padding: 0 5%;
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 2rem;
    align-items: start;
    margin-bottom: 4rem;
}

        /* Left Column - Form */
        .form-column {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        /* Right Column - Tips Sidebar */
        .tips-sidebar {
            position: sticky;
            top: 88px;
            align-self: start;
        }

        .tips-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tips-card h3 {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tips-card ul {
            list-style: none;
            padding: 0;
        }

        .tips-card li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
            color: var(--gray-600);
            display: flex;
            align-items: start;
            gap: 0.5rem;
        }

        .tips-card li:last-child {
            border-bottom: none;
        }

        .tips-card li::before {
            content: "✓";
            color: var(--success);
            font-weight: 700;
            flex-shrink: 0;
        }

        /* Progress Steps (Horizontal like Flippa) */
        .progress-bar-wrapper {
            background: var(--gray-50);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .progress-steps::before {
    content: '';
    position: absolute;
    top: 16px;
    left: 5%; /* CHANGED from 0 */
    right: 5%; /* CHANGED from 0 */
    height: 2px;
    background: var(--gray-200);
    z-index: 0;
}

.progress-line {
    position: absolute;
    top: 16px;
    left: 5%; /* CHANGED from 0 */
    height: 2px;
    background: var(--primary);
    z-index: 1;
    transition: width 0.3s ease;
}

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            cursor: pointer;
            flex: 1;
        }

        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }

        .step.active .step-circle {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .step.completed .step-circle {
            background: var(--success);
            color: var(--white);
            border-color: var(--success);
        }

        .step.completed .step-circle::after {
            content: "✓";
            font-size: 1rem;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            font-weight: 500;
            text-align: center;
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        /* Form Content */
        .form-content {
            padding: 2rem;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .section-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .section-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .section-header p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
        }

        .required {
            color: var(--error);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.2s;
            outline: none;
            background: var(--white);
            color: var(--gray-900);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-hint {
            font-size: 0.8125rem;
            color: var(--gray-500);
            margin-top: 0.375rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* License Type Card (NEW) */
        .license-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .license-card {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .license-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
        }

        .license-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.03);
        }

        .license-card.selected::after {
            content: "✓";
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .license-card h4 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .license-card .badge {
            display: inline-block;
            background: var(--gray-100);
            color: var(--gray-700);
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .license-card.selected .badge {
            background: var(--primary);
            color: var(--white);
        }

        .license-card ul {
            list-style: none;
            padding: 0;
            margin: 0.75rem 0 0 0;
        }

        .license-card li {
            font-size: 0.8125rem;
            color: var(--gray-600);
            padding: 0.375rem 0;
            display: flex;
            align-items: start;
            gap: 0.5rem;
        }

        .license-card li::before {
            content: "•";
            color: var(--primary);
            font-weight: 700;
        }

        .pricing-inputs {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 6px;
        }

        .pricing-inputs.active {
            display: block;
        }

/* License Radio Button Styling */
.license-radio-option:has(input:checked) {
    border-color: var(--primary);
    background: rgba(249, 115, 22, 0.05);
}

.license-radio-option:hover {
    border-color: var(--primary);
}







        /* Category Grid (Flippa-style) */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .category-card {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            position: relative;
        }

        .category-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
        }

        .category-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.03);
        }

        .category-card.selected::after {
            content: "✓";
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 20px;
            height: 20px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.75rem;
        }

        .category-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 0.75rem;
            color: var(--primary);
        }

        .category-card h4 {
            font-size: 0.9375rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .category-card p {
            font-size: 0.8125rem;
            color: var(--gray-600);
            line-height: 1.4;
        }

        .badge-new {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            background: var(--success);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* Image Upload */
        .image-upload-container {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--gray-50);
        }

        .image-upload-container:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.03);
        }

        .image-upload-container input[type="file"] {
            display: none;
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-item .remove-image {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--error);
            color: var(--white);
            border: none;
            border-radius: 4px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s;
            z-index: 10;
        }

        .image-preview-item .remove-image:hover {
            background: #DC2626;
        }

        .upload-progress {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 6px;
            display: none;
        }

        .upload-progress.active {
            display: block;
        }

        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: var(--gray-200);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        /* Form Actions */
    .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: space-between;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
}

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
        }

        .btn-primary {
    background: var(--primary);
    color: var(--white);
}
        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Success Message */
        .success-message {
            display: none;
            text-align: center;
            padding: 3rem 2rem;
        }

        .success-message.active {
            display: block;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            color: var(--success);
        }

        .success-message h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--gray-900);
        }

        .success-message p {
            color: var(--gray-600);
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-content {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 440px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-400);
            transition: color 0.2s;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--gray-700);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .auth-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: var(--gray-600);
            font-size: 0.9375rem;
        }

        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            background: none;
            border: none;
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            font-family: 'Inter', sans-serif;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .submit-btn {
            width: 100%;
            background: var(--primary);
            color: var(--white);
            padding: 0.875rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .submit-btn:hover {
            background: var(--primary-dark);
        }

        .auth-divider {
            text-align: center;
            margin: 1.25rem 0;
            color: var(--gray-500);
            position: relative;
            font-size: 0.875rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 42%;
            height: 1px;
            background: var(--border);
        }

        .auth-divider::before {
            left: 0;
        }

        .auth-divider::after {
            right: 0;
        }

        .google-signin-btn {
            width: 100%;
            background: var(--white);
            border: 1px solid var(--border);
            padding: 0.875rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .google-signin-btn:hover {
            background: var(--gray-50);
        }

        .google-icon {
            width: 20px;
            height: 20px;
        }

        .auth-note {
            text-align: center;
            color: var(--gray-600);
            font-size: 0.8125rem;
            margin-top: 1.25rem;
        }

        .auth-note a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Quota Info Banner */
        .quota-banner {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(16, 185, 129, 0.05));
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .quota-banner-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quota-info h4 {
            margin: 0 0 0.375rem 0;
            color: var(--primary);
            font-size: 1rem;
            font-weight: 700;
        }

        .quota-info p {
            margin: 0;
            color: var(--gray-700);
            font-size: 0.875rem;
        }

        .upgrade-btn {
            background: var(--primary);
            color: var(--white);
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upgrade-btn:hover {
            background: var(--primary-dark);
        }

        /* Footer */
       footer {
    background: var(--gray-900);
    color: var(--white);
    padding: 3rem 5% 1.5rem;
    margin-top: 4rem;
    clear: both; /* ADD THIS */
    width: 100%; /* ADD THIS */
    grid-column: 1 / -1; /* ADD THIS - ensures footer spans full width */
}
        .footer-container {
            max-width: 1280px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-brand h3 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        .footer-brand p {
            opacity: 0.8;
            line-height: 1.6;
            font-size: 0.9375rem;
        }

        .footer-links h4 {
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.625rem;
        }

        .footer-links a {
            color: var(--white);
            opacity: 0.8;
            text-decoration: none;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .footer-links a:hover {
            opacity: 1;
            color: var(--primary);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            opacity: 0.7;
            font-size: 0.875rem;
        }

      
@media (max-width: 1024px) {
    .main-container {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .tips-sidebar {
        position: static;
    }

    .category-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .license-options {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .nav-links {
        display: none;
    }

    .page-header h1 {
        font-size: 1.5rem;
    }

    .form-content {
        padding: 1.5rem;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .category-grid {
        grid-template-columns: 1fr;
    }

    .footer-container {
        grid-template-columns: 1fr;
    }

    .progress-steps {
        overflow-x: auto;
        justify-content: flex-start;
        padding-bottom: 0.5rem;
    }

    .step {
        min-width: 80px;
    }

    .step-label {
        font-size: 0.6875rem;
    }
}
        /* Review Section */
        .review-section {
            background: var(--gray-50);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .review-section h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1rem;
            font-weight: 700;
        }

        .review-item {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .review-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .review-item strong {
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .review-item p {
            color: var(--gray-900);
            margin-top: 0.25rem;
            font-size: 0.9375rem;
        }

        /* Auth Loading */
        .auth-loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .auth-loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* License Pricing Table */
        .license-pricing-table {
            margin-top: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .license-pricing-header {
            display: grid;
            grid-template-columns: 2fr 1fr;
            background: var(--gray-50);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .license-pricing-header > div {
            padding: 0.75rem 1rem;
            border-right: 1px solid var(--border);
        }

        .license-pricing-header > div:last-child {
            border-right: none;
        }

        .license-pricing-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            border-top: 1px solid var(--border);
        }

        .license-pricing-row > div {
            padding: 1rem;
            border-right: 1px solid var(--border);
        }

        .license-pricing-row > div:last-child {
            border-right: none;
        }

        .license-pricing-row input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9375rem;
        }


        /* Alert Box */
        .alert-box {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: start;
            gap: 0.75rem;
            font-size: 0.875rem;
        }

        .alert-info {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #D97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }


    </style>
</head>
<body>
 <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">Systemly</a>
            <div class="nav-links">
                <a href="marketplace.html">Marketplace</a>
                <a href="how-it-works.html">How It Works</a>
                <a href="pricing.html">Pricing</a>
                <a href="about.html">About</a>
            </div>
            <button class="sign-in-btn" id="signInBtn" onclick="showAuthModal()">Sign In</button>
            <div class="user-profile" id="userProfile">
                <img src="" alt="User" class="user-avatar" id="userAvatar">
                <span class="user-name" id="userName"></span>
            </div>
        </div>
    </nav>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-modal" onclick="closeAuthModal()">×</button>
            <div class="auth-header">
                <h2>Welcome to Systemly</h2>
                <p>Sign in to list your digital system</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('signin')">Sign In</button>
                <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
            </div>

            <!-- Sign In Form -->
            <form class="auth-form active" id="signInForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="signInEmail" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="signInPassword" required placeholder="••••••••">
                </div>
                <button type="submit" class="submit-btn">Sign In</button>
            </form>

            <!-- Sign Up Form -->
            <form class="auth-form" id="signUpForm">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" class="form-input" id="signUpName" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-input" id="signUpEmail" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-input" id="signUpPassword" required placeholder="••••••••">
                </div>
                <button type="submit" class="submit-btn">Create Account</button>
            </form>

            <div class="auth-divider">or</div>
            
            <button class="google-signin-btn" id="googleSignInBtn">
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continue with Google
            </button>

            <div class="auth-note">
                By continuing, you agree to our <a href="terms.html">Terms of Service</a> and <a href="privacy.html">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <h1>List Your Digital Asset for Sale</h1>
            <p>Complete the form below to create your listing. Our team will review it within 24-48 hours.</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Column: Form -->
        <div class="form-column">
            <div id="authRequired" style="display: block;">
                <div class="auth-loading active" id="authLoading">
                    <div class="spinner"></div>
                    <p>Checking authentication...</p>
                </div>
                
                <div id="authRequiredContent" style="display: none; padding: 3rem 2rem; text-align: center;">
                    <svg style="width: 64px; height: 64px; margin: 0 auto 1rem; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <h2 style="margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: 700;">Ready to List Your Asset?</h2>
                    <p style="margin-bottom: 1.5rem; color: var(--gray-600);">Sign in to get started with your listing</p>
                    <button class="btn btn-primary" id="authRequiredBtn" style="width: auto; padding: 0.875rem 2rem; display: inline-flex; margin: 0 auto;">
                        <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                        </svg>
                        Sign In to Continue
                    </button>
                </div>
            </div>

            <div id="listingForm" class="listing-form" style="display: none;">
                <!-- Progress Bar -->
                <div class="progress-bar-wrapper">
                    <div class="progress-steps">
                        <div class="progress-line" id="progressLine" style="width: 0%"></div>
                        <div class="step active" data-step="1">
                            <div class="step-circle">1</div>
                            <div class="step-label">Category</div>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Details</div>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Images</div>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-circle">4</div>
                            <div class="step-label">Pricing</div>
                        </div>
                        <div class="step" data-step="5">
                            <div class="step-circle">5</div>
                            <div class="step-label">Financials</div>
                        </div>
                        <div class="step" data-step="6">
                            <div class="step-circle">6</div>
                            <div class="step-label">Review</div>
                        </div>
                    </div>
                </div>

                <form id="sellSystemForm">
                    <div class="form-content">
                        <!-- Step 1: Category Selection -->
                        <div class="form-step active" data-step="1">
                            <div class="section-header">
                                <h2>Select Business Category</h2>
                                <p>Choose the category that best describes your digital asset</p>
                            </div>

                            <div class="category-grid">
                                <div class="category-card" data-category="content" onclick="selectCategory('content')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h4>Content</h4>
                                    <p>Blogs, Directories, Forums</p>
                                </div>

                                <div class="category-card" data-category="saas" onclick="selectCategory('saas')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <h4>SaaS</h4>
                                    <p>Software as a Service</p>
                                </div>

                                <div class="category-card" data-category="ecommerce" onclick="selectCategory('ecommerce')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    <h4>Ecommerce</h4>
                                    <p>Online Stores</p>
                                </div>

                                <div class="category-card" data-category="mobile-app" onclick="selectCategory('mobile-app')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                    <h4>Mobile App</h4>
                                    <p>iOS & Android Apps</p>
                                </div>

                                <div class="category-card" data-category="social-media" onclick="selectCategory('social-media')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                    </svg>
                                    <h4>Social Media</h4>
                                    <p>YouTube, Instagram, TikTok</p>
                                </div>

                                <div class="category-card" data-category="marketplace" onclick="selectCategory('marketplace')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                    <h4>Marketplace</h4>
                                    <p>Digital Marketplaces</p>
                                </div>

                                <div class="category-card" data-category="amazon-store" onclick="selectCategory('amazon-store')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                    <h4>Amazon Store</h4>
                                    <p>FBA, FBM, KDP</p>
                                </div>

                                <div class="category-card new-badge" data-category="plugins" onclick="selectCategory('plugins')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
                                    </svg>
                                    <h4>Plugins</h4>
                                    <p>WordPress, Shopify, Chrome</p>
                                </div>

                                <div class="category-card new-badge" data-category="agencies" onclick="selectCategory('agencies')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
                                    </svg>
                                    <h4>Digital Agencies</h4>
                                    <p>Marketing, Creative, Dev</p>
                                </div>

                                <div class="category-card" data-category="service" onclick="selectCategory('service')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <h4>Service Business</h4>
                                    <p>Consulting, Freelancing</p>
                                </div>

                                <div class="category-card new-badge" data-category="ai-tools" onclick="selectCategory('ai-tools')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                    <h4>AI Tools</h4>
                                    <p>GPT, Claude, AI Apps</p>
                                </div>

                                <div class="category-card new-badge" data-category="gaming" onclick="selectCategory('gaming')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
                                    </svg>
                                    <h4>Gaming</h4>
                                    <p>Games, Mods, Skins</p>
                                </div>

                                <div class="category-card new-badge" data-category="crypto" onclick="selectCategory('crypto')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <h4>Crypto & Blockchain</h4>
                                    <p>NFTs, DeFi, Web3</p>
                                </div>

                                <div class="category-card" data-category="domain" onclick="selectCategory('domain')">
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                    </svg>
                                    <h4>Domain</h4>
                                    <p>Premium Domains</p>
                                </div>

                                <div class="category-card new-badge" data-category="projects" onclick="selectCategory('projects')">
                                    <span class="badge-new">New!</span>
                                    <svg class="category-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                    <h4>Projects & Concepts</h4>
                                    <p>MVPs, Prototypes</p>
                                </div>
                            </div>

                            <input type="hidden" name="category" id="selectedCategory" required>
                        </div>

                        <!-- Step 2: Category-Specific Details -->
                        <div class="form-step" data-step="2">
                            <div id="categorySpecificFields">
                                <!-- Fields will be dynamically inserted based on selected category -->
                            </div>
                        </div>

                        <!-- Step 3: Image Upload -->
                        <div class="form-step" data-step="3">
                            <div class="section-header">
                                <h2>Upload Images</h2>
                                <p>Add high-quality images to showcase your asset (up to 5 images)</p>
                            </div>

                            <div class="alert-box alert-info">
                                <svg style="width: 20px; height: 20px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <strong>Image Tips:</strong> Include screenshots of dashboards, analytics, key features, and user interface. The first image will be your main thumbnail.
                                </div>
                            </div>

                            <div class="form-group">
                                <label>System Images <span class="required">*</span></label>
                                <div class="image-upload-container" id="imageUploadContainer">
                                    <input type="file" id="imageUpload" accept="image/*" multiple>
                                    <svg style="width: 64px; height: 64px; margin: 0 auto 1rem; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-700);">Click to upload or drag and drop</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-500);">PNG, JPG, GIF up to 5MB each (Max 5 images)</div>
                                </div>
                                
                                <div class="upload-progress" id="uploadProgress">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                        <span id="uploadStatus">Uploading...</span>
                                        <span id="uploadPercentage">0%</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                                    </div>
                                </div>

                                <div class="image-preview-grid" id="imagePreviewGrid">
                                    <!-- Uploaded images will appear here -->
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Variant Options & Pricing -->
                        <div class="form-step" data-step="4">
                            <div class="section-header">
                                <h2>Pricing & License Options</h2>
                                <p>Define what you're offering and set your prices</p>
                            </div>
<!-- LICENSE TYPE SELECTION -->
<div class="form-group">
    <label style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; display: block;">
        Select License Type <span class="required">*</span>
    </label>
    
    <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; padding: 1rem; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s;" class="license-radio-option" onclick="selectLicenseType('inclusive')">
            <input type="radio" name="licenseType" id="inclusiveVariantToggle" value="inclusive" style="width: 18px; height: 18px; margin-right: 0.75rem; cursor: pointer; accent-color: var(--primary);">
            <div>
                <div style="font-weight: 600; margin-bottom: 0.25rem;">Inclusive License</div>
                <div style="font-size: 0.875rem; color: var(--gray-600);">Can be sold multiple times to different buyers</div>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; padding: 1rem; border: 2px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.2s;" class="license-radio-option" onclick="selectLicenseType('exclusive')">
            <input type="radio" name="licenseType" id="exclusiveVariantToggle" value="exclusive" style="width: 18px; height: 18px; margin-right: 0.75rem; cursor: pointer; accent-color: var(--success);">
            <div>
                <div style="font-weight: 600; margin-bottom: 0.25rem;">Exclusive License</div>
                <div style="font-size: 0.875rem; color: var(--gray-600);">One-time sale with full rights transfer</div>
            </div>
        </label>
    </div>
</div>

<!-- INCLUSIVE LICENSE FIELDS -->
<div id="inclusiveVariantFields" style="display: none;">
    <div class="form-group">
        <label>What's Included? <span class="required">*</span></label>
        <textarea 
            class="form-textarea" 
            id="inclusiveDescription" 
            name="inclusiveDescription" 
            placeholder="List what the buyer gets with this license (e.g., system access, documentation, support period, etc.)"
            style="min-height: 120px;"
        ></textarea>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Price (₱) <span class="required">*</span></label>
            <input 
                type="number" 
                class="form-input" 
                id="inclusivePrice" 
                name="inclusivePrice" 
                placeholder="20000" 
                min="0"
            >
        </div>

        <div class="form-group">
            <label>Additional Notes (Optional)</label>
            <input 
                type="text" 
                class="form-input" 
                id="inclusiveNotes" 
                name="inclusiveNotes" 
                placeholder="e.g., Limited to 100 licenses">
        </div>
    </div>
</div>

<!-- EXCLUSIVE LICENSE FIELDS -->
<div id="exclusiveVariantFields" style="display: none;">
    <div class="form-group">
        <label>What's Included? <span class="required">*</span></label>
        <textarea 
            class="form-textarea" 
            id="exclusiveDescription" 
            name="exclusiveDescription" 
            placeholder="List what the buyer gets with this license (e.g., source code, IP rights, database, etc.)"
            style="min-height: 120px;"
        ></textarea>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Price (₱) <span class="required">*</span></label>
            <input 
                type="number" 
                class="form-input" 
                id="exclusivePrice" 
                name="exclusivePrice" 
                placeholder="75000" 
                min="0"
            >
        </div>

        <div class="form-group">
            <label>Additional Notes (Optional)</label>
            <input 
                type="text" 
                class="form-input" 
                id="exclusiveNotes" 
                name="exclusiveNotes" 
                placeholder="e.g., Negotiable for serious buyers"
            >
        </div>
    </div>

    <div class="form-group" style="margin-top: 1rem;">
        <label style="display: flex; align-items: center; cursor: pointer; font-weight: 500; font-size: 0.9375rem;">
            <input type="checkbox" id="exclusiveSoldOnce" name="exclusiveSoldOnce" style="width: 18px; height: 18px; margin-right: 0.75rem; cursor: pointer; accent-color: var(--success);">
            <span>This license can only be sold once</span>
        </label>
    </div>
</div>

                            <div class="alert-box alert-info">
                                <svg style="width: 20px; height: 20px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <strong>Note:</strong> You must enable at least one license option. Buyers will choose their preferred option at checkout.
                                </div>
                            </div>

                            <input type="hidden" name="availableVariants" id="availableVariants">
                        </div>

                        <!-- Step 5: Financial Information -->
                        <div class="form-step" data-step="5">
                            <div class="section-header">
                                <h2>Financial Information</h2>
                                <p>Provide accurate financial details to attract serious buyers</p>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Monthly Revenue (₱) <span class="required">*</span></label>
                                    <input type="number" class="form-input" name="monthlyRevenue" required placeholder="5,000">
                                    <div class="form-hint">Average over last 6 months</div>
                                </div>

                                <div class="form-group">
                                    <label>Monthly Profit (₱) <span class="required">*</span></label>
                                    <input type="number" class="form-input" name="monthlyProfit" required placeholder="3,500">
                                    <div class="form-hint">Revenue minus expenses</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Reason for Selling <span class="required">*</span></label>
                                <select class="form-select" name="reasonForSelling" required>
                                    <option value="">Select reason</option>
                                    <option value="new-venture">Starting new venture</option>
                                    <option value="focus">Want to focus on other projects</option>
                                    <option value="time">No time to manage</option>
                                    <option value="retirement">Retirement</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>System Age <span class="required">*</span></label>
                                <select class="form-select" name="systemAge" required>
                                    <option value="">Select age</option>
                                    <option value="0-6">Less than 6 months</option>
                                    <option value="6-12">6-12 months</option>
                                    <option value="1-2">1-2 years</option>
                                    <option value="2-5">2-5 years</option>
                                    <option value="5+">5+ years</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Support Period <span class="required">*</span></label>
                                <select class="form-select" name="supportPeriod" required>
                                    <option value="">Select support period</option>
                                    <option value="none">No support</option>
                                    <option value="1week">1 week</option>
                                    <option value="2weeks">2 weeks</option>
                                    <option value="1month">1 month</option>
                                    <option value="3months">3 months</option>
                                </select>
                                <div class="form-hint">How long will you help the buyer transition?</div>
                            </div>

                            <div class="form-group">
                                <label>Upload Financial Documents (Optional)</label>
                                <div class="image-upload-container" onclick="document.getElementById('financialDocs').click()" style="padding: 1.5rem;">
                                    <input type="file" id="financialDocs" name="financialDocs" accept=".pdf,.xlsx,.csv" multiple style="display: none;">
                                    <svg style="width: 48px; height: 48px; margin: 0 auto 0.75rem; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--gray-700);">Upload financial documents</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-500);">PDF, Excel, or CSV (optional but recommended)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 6: Review & Submit -->
                        <div class="form-step" data-step="6">
                            <div class="section-header">
                                <h2>Review Your Listing</h2>
                                <p>Please review all information before submitting</p>
                            </div>

                            <div id="reviewContent">
                                <!-- Review content will be populated by JavaScript -->
                            </div>

                            <!-- Review Notice Banner -->
                            <div class="alert-box alert-warning" style="margin-bottom: 2rem;">
                                <svg style="width: 24px; height: 24px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <strong>Listing Review Process</strong><br>
                                    Your listing will be reviewed by our team within <strong>24-48 hours</strong>. You'll receive an email notification once it's approved and published. We verify all listings to maintain marketplace quality.
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label style="display: flex; align-items: center; cursor: pointer; font-weight: 500;">
                                    <input type="checkbox" id="agreeTerms" required style="width: 18px; height: 18px; margin-right: 0.75rem; cursor: pointer; accent-color: var(--primary);">
                                    <span>I agree to the <a href="terms.html" style="color: var(--primary); text-decoration: none; font-weight: 600;">Terms of Service</a> and confirm all information is accurate</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions - OUTSIDE all steps -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                            <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">
                            Next
                            <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn" style="display: none;">
                            <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Submit Listing
                        </button>
                    </div>

                    <!-- Success Message -->
                    <div class="success-message" id="successMessage">
                        <svg class="success-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h2>Listing Submitted Successfully!</h2>
                        <p>Your asset is now under review. Our team will verify the information and publish your listing within 24-48 hours.</p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="window.location.href='marketplace.html'" style="display: inline-flex;">
                                <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                Browse Marketplace
                            </button>
                            <button class="btn btn-secondary" onclick="window.location.href='dashboard.html'" style="display: inline-flex;">
                                <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                                </svg>
                                View Dashboard
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Column: Tips Sidebar -->
        <div class="tips-sidebar">
            <div class="tips-card">
                <h3>
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    Listing Tips
                </h3>
                <ul>
                    <li>Use clear, high-quality screenshots showing your dashboard and analytics</li>
                    <li>Be transparent about revenue, traffic, and growth trends</li>
                    <li>Provide detailed information about tech stack and operations</li>
                    <li>Explain what makes your asset valuable and unique</li>
                    <li>Include information about the included assets and support</li>
                </ul>
            </div>

            <div class="tips-card">
                <h3>
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Pricing Guide
                </h3>
                <ul>
                    <li>Most digital assets sell for 12-36x monthly profit</li>
                    <li>SaaS businesses typically command 3-5x annual revenue</li>
                    <li>Content sites average 24-36x monthly profit</li>
                    <li>Consider growth trajectory when pricing</li>
                    <li>Be realistic - overpricing delays sales</li>
                </ul>
            </div>

            <div class="tips-card" style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(16, 185, 129, 0.05)); border-color: var(--primary);">
                <h3 style="color: var(--primary);">
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Quick Stats
                </h3>
                <ul style="border: none;">
                    <li style="border-bottom: 1px solid var(--border);">Average sale time: <strong>14 days</strong></li>
                    <li style="border-bottom: 1px solid var(--border);">Success rate: <strong>98%</strong></li>
                    <li style="border-bottom: 1px solid var(--border);">Avg listing views: <strong>450+</strong></li>
                    <li style="border-bottom: none;">Total sales volume: <strong>₱24M+</strong></li>
                </ul>
            </div>

            <div class="tips-card">
                <h3>
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    Need Help?
                </h3>
                <ul style="border: none;">
                    <li style="border-bottom: 1px solid var(--border);">
                        <a href="#" style="text-decoration: none; color: var(--primary); font-weight: 600;">View Listing Guide</a>
                    </li>
                    <li style="border-bottom: 1px solid var(--border);">
                        <a href="#" style="text-decoration: none; color: var(--primary); font-weight: 600;">Valuation Calculator</a>
                    </li>
                    <li style="border-bottom: none;">
                        <a href="#" style="text-decoration: none; color: var(--primary); font-weight: 600;">Contact Support</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-brand">
                <h3>Systemly</h3>
                <p>The trusted marketplace for buying and selling digital systems, automation workflows, and online businesses.</p>
            </div>
            <div class="footer-links">
                <h4>Platform</h4>
                <ul>
                    <li><a href="marketplace.html">Browse Systems</a></li>
                    <li><a href="sell.html">Sell Your System</a></li>
                    <li><a href="how-it-works.html">How It Works</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Resources</h4>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Valuation Tool</a></li>
                    <li><a href="#">Success Stories</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h4>Company</h4>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Systemly. All rights reserved.</p>
        </div>
    </footer>

<!-- Firebase SDKs and JavaScript -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, doc, setDoc, updateDoc, getDoc, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD3PQ5oWrzAXOHnb7wrmpRhL9DWIB7w9rE",
        authDomain: "systemly-db.firebaseapp.com",
        projectId: "systemly-db",
        storageBucket: "systemly-db.firebasestorage.app",
        messagingSenderId: "32599486733",
        appId: "1:32599486733:web:16d34643c8f920a6fd8044"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // Global variables
    let currentUser = null;
    let currentStep = 1;
    const totalSteps = 6;
    const formData = {};
    const uploadedImages = [];
    const CLOUDINARY_CLOUD_NAME = 'dxv11m11i';
    const CLOUDINARY_UPLOAD_PRESET = 'systemly_uploads';
    const MAX_IMAGES = 5;
    let selectedCategory = null;
    let selectedLicense = null;
    let userQuotaInfo = null;
    let isEditMode = false;
    let editingListingId = null;
    let editingListingData = null;

    const categoryFields = {
    'content': {
        name: 'Content Site',
        fields: [
            { name: 'systemName', label: 'Site/Business Name', type: 'text', required: true, placeholder: 'e.g., Tech Review Blog' },
            { name: 'contentType', label: 'Content Type', type: 'select', required: true, options: ['Blog', 'Directory', 'Review Site', 'Forum/Community', 'News Site', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Comprehensive description including niche, audience, content strategy, and unique value proposition', rows: 6 },
            { name: 'domain', label: 'Domain Name', type: 'text', required: true, placeholder: 'example.com' },
            { name: 'monthlyVisitors', label: 'Monthly Visitors/Pageviews', type: 'number', placeholder: '10000' },
            { name: 'contentManagementSystem', label: 'CMS/Platform', type: 'select', options: ['WordPress', 'Ghost', 'Webflow', 'Custom Built', 'Other'] }
        ]
    },
    'saas': {
        name: 'SaaS Business',
        fields: [
            { name: 'systemName', label: 'SaaS Name', type: 'text', required: true, placeholder: 'e.g., Project Management Tool' },
            { name: 'saasType', label: 'SaaS Type', type: 'select', required: true, options: ['B2B', 'B2C', 'B2B2C', 'Enterprise', 'SMB'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your SaaS product, features, target market, and competitive advantages', rows: 6 },
            { name: 'techStack', label: 'Tech Stack', type: 'text', required: true, placeholder: 'e.g., React, Node.js, PostgreSQL, AWS' },
            { name: 'mrr', label: 'Monthly Recurring Revenue (MRR)', type: 'number', required: true, placeholder: '5000' },
            { name: 'activeSubscribers', label: 'Active Subscribers', type: 'number', required: true, placeholder: '150' },
            { name: 'churnRate', label: 'Monthly Churn Rate (%)', type: 'number', placeholder: '5' },
            { name: 'pricingModel', label: 'Pricing Model', type: 'select', options: ['Subscription', 'Usage-Based', 'Freemium', 'One-Time Payment', 'Tiered', 'Other'] }
        ]
    },
    'ecommerce': {
        name: 'Ecommerce Business',
        fields: [
            { name: 'systemName', label: 'Store Name', type: 'text', required: true, placeholder: 'e.g., Organic Skincare Store' },
            { name: 'ecommerceType', label: 'Business Model', type: 'select', required: true, options: ['Dropshipping', 'Print on Demand', 'Private Label', 'Wholesale', 'Handmade/Craft', 'Digital Products', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your products, niche, target audience, and what makes your store unique', rows: 6 },
            { name: 'platform', label: 'Ecommerce Platform', type: 'select', required: true, options: ['Shopify', 'WooCommerce', 'BigCommerce', 'Magento', 'Custom Built', 'Other'] },
            { name: 'productCount', label: 'Number of Products', type: 'number', placeholder: '50' },
            { name: 'averageOrderValue', label: 'Average Order Value (₱)', type: 'number', placeholder: '75' },
            { name: 'orderVolume', label: 'Monthly Orders', type: 'number', placeholder: '200' }
        ]
    },
    'mobile-app': {
        name: 'Mobile App',
        fields: [
            { name: 'systemName', label: 'App Name', type: 'text', required: true, placeholder: 'e.g., Fitness Tracker Pro' },
            { name: 'appPlatform', label: 'Platform', type: 'select', required: true, options: ['iOS Only', 'Android Only', 'Both iOS & Android', 'Cross-Platform'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your app features, target users, and unique selling points', rows: 6 },
            { name: 'appCategory', label: 'App Category', type: 'select', required: true, options: ['Productivity', 'Health & Fitness', 'Entertainment', 'Education', 'Finance', 'Social Networking', 'Games', 'Utilities', 'Other'] },
            { name: 'downloads', label: 'Total Downloads', type: 'number', placeholder: '50000' },
            { name: 'activeUsers', label: 'Monthly Active Users', type: 'number', placeholder: '10000' },
            { name: 'techStack', label: 'Development Framework', type: 'select', options: ['Native iOS (Swift)', 'Native Android (Kotlin/Java)', 'React Native', 'Flutter', 'Xamarin', 'Other'] },
            { name: 'monetization', label: 'Monetization Method', type: 'select', options: ['In-App Purchases', 'Subscription', 'Ads', 'Freemium', 'Paid App', 'Sponsorships', 'Multiple', 'None'] }
        ]
    },
    'social-media': {
        name: 'Social Media & Content',
        fields: [
            { name: 'systemName', label: 'Channel/Account Name', type: 'text', required: true, placeholder: 'e.g., Tech Tips Daily' },
            { name: 'platformType', label: 'Platform', type: 'select', required: true, options: ['YouTube', 'Instagram', 'TikTok', 'Twitter/X', 'Newsletter', 'Podcast', 'Multiple Platforms', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your content, niche, audience demographics, and engagement metrics', rows: 6 },
            { name: 'followers', label: 'Followers/Subscribers', type: 'number', required: true, placeholder: '50000' },
            { name: 'engagement', label: 'Average Engagement Rate (%)', type: 'number', placeholder: '3.5' },
            { name: 'monthlyViews', label: 'Monthly Views/Impressions', type: 'number', placeholder: '100000' },
            { name: 'contentNiche', label: 'Content Niche', type: 'text', placeholder: 'e.g., Technology, Lifestyle, Finance' }
        ]
    },
    'marketplace': {
        name: 'Digital Marketplace',
        fields: [
            { name: 'systemName', label: 'Marketplace Name', type: 'text', required: true, placeholder: 'e.g., Freelance Designer Hub' },
            { name: 'marketplaceType', label: 'Marketplace Type', type: 'select', required: true, options: ['Service Marketplace', 'Product Marketplace', 'Two-Sided Platform', 'P2P Marketplace', 'B2B Marketplace', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your marketplace, user base, transaction flow, and competitive advantages', rows: 6 },
            { name: 'registeredUsers', label: 'Registered Users', type: 'number', placeholder: '5000' },
            { name: 'activeListings', label: 'Active Listings/Products', type: 'number', placeholder: '500' },
            { name: 'monthlyTransactions', label: 'Monthly Transactions', type: 'number', placeholder: '200' },
            { name: 'commissionRate', label: 'Commission Rate (%)', type: 'number', placeholder: '10' }
        ]
    },
    'amazon-store': {
        name: 'Amazon Store',
        fields: [
            { name: 'systemName', label: 'Store/Brand Name', type: 'text', required: true, placeholder: 'e.g., Premium Home Goods' },
            { name: 'amazonType', label: 'Amazon Business Type', type: 'select', required: true, options: ['FBA (Fulfilled by Amazon)', 'FBM (Fulfilled by Merchant)', 'KDP (Kindle Publishing)', 'Private Label FBA', 'Wholesale FBA', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your products, brand, sourcing, and competitive advantages', rows: 6 },
            { name: 'skuCount', label: 'Number of SKUs', type: 'number', placeholder: '15' },
            { name: 'monthlyUnits', label: 'Monthly Units Sold', type: 'number', placeholder: '500' },
            { name: 'averageSellingPrice', label: 'Average Selling Price (₱)', type: 'number', placeholder: '35' },
            { name: 'amazonMarketplace', label: 'Primary Marketplace', type: 'select', options: ['Amazon.com (USA)', 'Amazon.co.uk (UK)', 'Amazon.de (Germany)', 'Amazon.ca (Canada)', 'Multiple Marketplaces', 'Other'] }
        ]
    },
    'plugins': {
        name: 'Plugins & Extensions',
        fields: [
            { name: 'systemName', label: 'Plugin/Extension Name', type: 'text', required: true, placeholder: 'e.g., SEO Optimizer Pro' },
            { name: 'pluginPlatform', label: 'Platform', type: 'select', required: true, options: ['WordPress Plugin', 'Shopify App', 'Chrome Extension', 'Firefox Extension', 'Safari Extension', 'Multiple Platforms', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe functionality, features, target users, and benefits', rows: 6 },
            { name: 'activeInstalls', label: 'Active Installations', type: 'number', placeholder: '5000' },
            { name: 'rating', label: 'Average Rating (1-5)', type: 'number', step: '0.1', placeholder: '4.5' },
            { name: 'reviewCount', label: 'Number of Reviews', type: 'number', placeholder: '250' },
            { name: 'pricingModel', label: 'Pricing Model', type: 'select', options: ['Free', 'Freemium', 'One-Time Purchase', 'Subscription', 'Usage-Based', 'Other'] }
        ]
    },
    'agencies': {
        name: 'Digital Agency',
        fields: [
            { name: 'systemName', label: 'Agency Name', type: 'text', required: true, placeholder: 'e.g., Creative Digital Solutions' },
            { name: 'agencyType', label: 'Agency Type', type: 'select', required: true, options: ['Brand & Creative', 'Digital Marketing', 'Software Development', 'SEO/SEM', 'Social Media Marketing', 'Full-Service', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your services, client base, team structure, and unique value proposition', rows: 6 },
            { name: 'activeClients', label: 'Active Clients', type: 'number', placeholder: '15' },
            { name: 'teamSize', label: 'Team Size', type: 'number', placeholder: '5' },
            { name: 'averageProjectValue', label: 'Average Project Value (₱)', type: 'number', placeholder: '5000' },
            { name: 'retainerClients', label: 'Retainer Clients', type: 'number', placeholder: '8' }
        ]
    },
    'service': {
        name: 'Service Business',
        fields: [
            { name: 'systemName', label: 'Service Name', type: 'text', required: true, placeholder: 'e.g., Virtual Assistant Services' },
            { name: 'serviceType', label: 'Service Type', type: 'select', required: true, options: ['Consulting', 'Freelancing', 'Coaching', 'Training/Education', 'Design Services', 'Development Services', 'Virtual Assistant', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your services, target clients, delivery method, and competitive advantages', rows: 6 },
            { name: 'deliveryMethod', label: 'Delivery Method', type: 'select', options: ['Online/Remote', 'In-Person', 'Hybrid', 'Self-Service Platform', 'Other'] },
            { name: 'activeClients', label: 'Active/Monthly Clients', type: 'number', placeholder: '20' },
            { name: 'averageProjectDuration', label: 'Average Project Duration', type: 'text', placeholder: 'e.g., 2 weeks, 1 month' }
        ]
    },
    'ai-tools': {
        name: 'AI Apps & Tools',
        fields: [
            { name: 'systemName', label: 'AI Tool Name', type: 'text', required: true, placeholder: 'e.g., AI Content Generator' },
            { name: 'aiPlatform', label: 'AI Platform/Technology', type: 'select', required: true, options: ['OpenAI (GPT)', 'Anthropic (Claude)', 'Google (Gemini/Bard)', 'Custom ML Model', 'Multiple Platforms', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your AI tool, use cases, features, and how it leverages AI technology', rows: 6 },
            { name: 'aiUseCase', label: 'Primary Use Case', type: 'select', required: true, options: ['Content Generation', 'Image Generation', 'Data Analysis', 'Automation', 'Chatbot/Assistant', 'Code Generation', 'Translation', 'Summarization', 'Other'] },
            { name: 'activeUsers', label: 'Active Users', type: 'number', placeholder: '1000' },
            { name: 'apiCalls', label: 'Monthly API Calls/Usage', type: 'number', placeholder: '50000' },
            { name: 'pricingModel', label: 'Pricing Model', type: 'select', options: ['Subscription', 'Pay-per-Use', 'Freemium', 'API Credits', 'Free with Ads', 'Enterprise', 'Other'] }
        ]
    },
    'gaming': {
        name: 'Gaming Business',
        fields: [
            { name: 'systemName', label: 'Game/Asset Name', type: 'text', required: true, placeholder: 'e.g., Fantasy RPG Adventure' },
            { name: 'gamingType', label: 'Gaming Type', type: 'select', required: true, options: ['Mobile Game', 'PC Game', 'Console Game', 'Browser Game', 'Game Addons/Mods', 'Game Skins', 'Game Assets', 'Avatar/Character Sales', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your game/assets, gameplay, target audience, and unique features', rows: 6 },
            { name: 'gamePlatform', label: 'Platform', type: 'select', required: true, options: ['iOS', 'Android', 'Steam', 'Epic Games', 'PlayStation', 'Xbox', 'Nintendo Switch', 'Roblox', 'Minecraft', 'Unity Asset Store', 'Other'] },
            { name: 'downloads', label: 'Total Downloads/Sales', type: 'number', placeholder: '10000' },
            { name: 'activeUsers', label: 'Monthly Active Users', type: 'number', placeholder: '5000' },
            { name: 'gameGenre', label: 'Game Genre', type: 'text', placeholder: 'e.g., RPG, Strategy, Puzzle' }
        ]
    },
    'crypto': {
        name: 'Crypto & Blockchain',
        fields: [
            { name: 'systemName', label: 'Project Name', type: 'text', required: true, placeholder: 'e.g., NFT Marketplace' },
            { name: 'cryptoType', label: 'Project Type', type: 'select', required: true, options: ['NFT Marketplace', 'DeFi Platform', 'Crypto Exchange', 'Blockchain App', 'Token/Coin', 'DAO', 'Web3 Service', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your project, blockchain technology, use case, and community', rows: 6 },
            { name: 'blockchain', label: 'Blockchain', type: 'select', required: true, options: ['Ethereum', 'Binance Smart Chain', 'Polygon', 'Solana', 'Avalanche', 'Cardano', 'Multi-Chain', 'Other'] },
            { name: 'smartContracts', label: 'Smart Contracts', type: 'select', options: ['Yes - Audited', 'Yes - Not Audited', 'No', 'In Development'] },
            { name: 'activeWallets', label: 'Active Wallets/Users', type: 'number', placeholder: '1000' },
            { name: 'totalVolume', label: 'Total Transaction Volume (₱)', type: 'number', placeholder: '100000' }
        ]
    },
    'domain': {
        name: 'Domain',
        fields: [
            { name: 'systemName', label: 'Domain Name', type: 'text', required: true, placeholder: 'e.g., techstartup.com' },
            { name: 'domainExtension', label: 'Domain Extension', type: 'select', required: true, options: ['.com', '.net', '.org', '.io', '.co', '.ai', '.app', '.dev', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Describe why this domain is valuable (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe the domain value, potential use cases, SEO metrics, and why someone should buy it', rows: 6 },
            { name: 'domainAge', label: 'Domain Age', type: 'select', required: true, options: ['Less than 1 year', '1-2 years', '2-5 years', '5-10 years', '10+ years'] },
            { name: 'currentTraffic', label: 'Current Monthly Traffic', type: 'number', placeholder: '0' },
            { name: 'backlinks', label: 'Number of Backlinks', type: 'number', placeholder: '0' },
            { name: 'domainAuthority', label: 'Domain Authority (DA)', type: 'number', placeholder: '0' }
        ]
    },
    'projects': {
        name: 'Projects & Concepts',
        fields: [
            { name: 'systemName', label: 'Project Name', type: 'text', required: true, placeholder: 'e.g., Smart Home Dashboard' },
            { name: 'projectType', label: 'Project Type', type: 'select', required: true, options: ['MVP/Prototype', 'Beta Product', 'Concept/Idea', 'Partially Built', 'Complete but No Revenue', 'Other'] },
            { name: 'shortDescription', label: 'Short Description', type: 'textarea', required: true, maxlength: 200, placeholder: 'Brief overview (max 200 characters)' },
            { name: 'detailedDescription', label: 'Detailed Description', type: 'textarea', required: true, placeholder: 'Describe your project, current state, features, potential market, and monetization possibilities', rows: 6 },
            { name: 'completionStatus', label: 'Completion Status (%)', type: 'number', required: true, placeholder: '75' },
            { name: 'techStack', label: 'Tech Stack', type: 'text', placeholder: 'e.g., React, Python, Firebase' },
            { name: 'developmentTime', label: 'Time Invested', type: 'text', placeholder: 'e.g., 6 months, 200 hours' },
            { name: 'targetMarket', label: 'Target Market/Industry', type: 'text', placeholder: 'e.g., Small businesses, Developers' }
        ]
    }
};
    // Check URL for edit mode
    const urlParams = new URLSearchParams(window.location.search);
    const editId = urlParams.get('edit');

    if (editId) {
        isEditMode = true;
        editingListingId = editId;
        editingListingData = JSON.parse(sessionStorage.getItem('editingListingData') || '{}');
        
        if (editingListingData && editingListingData.id === editId) {
            console.log('📝 Edit mode activated for listing:', editId);
            window.addEventListener('DOMContentLoaded', function() {
                setTimeout(populateEditForm, 1000);
            });
        } else {
            alert('Could not load listing data for editing');
            window.location.href = 'dashboard.html';
        }
    }

    function populateEditForm() {
        console.log('Populating form with:', editingListingData);
        
        const pageHeader = document.querySelector('.page-header h1');
        if (pageHeader) pageHeader.textContent = 'Edit Your Listing';
        
        if (editingListingData.category) {
            selectedCategory = editingListingData.category;
            selectCategory(selectedCategory);
        }
        
        if (editingListingData.availableVariants) {
    setTimeout(() => {
        if (editingListingData.availableVariants.includes('inclusive')) {
            document.getElementById('inclusiveVariantToggle').checked = true;
            toggleVariantSection('inclusive');
        }
        if (editingListingData.availableVariants.includes('exclusive')) {
            document.getElementById('exclusiveVariantToggle').checked = true;
            toggleVariantSection('exclusive');
        }
    }, 500);
}
        
        Object.keys(editingListingData).forEach(key => {
            if (key !== 'id' && key !== 'userId' && key !== 'createdAt' && key !== 'images' && key !== 'thumbnails') {
                formData[key] = editingListingData[key];
            }
        });
        
        if (editingListingData.images && editingListingData.images.length > 0) {
            editingListingData.images.forEach((url, index) => {
                uploadedImages.push({
                    url: url,
                    display_url: url,
                    thumb: editingListingData.thumbnails?.[index] || url,
                    filename: `Image ${index + 1}`
                });
            });
            renderImagePreviews();
        }
        
        setTimeout(() => {
            fillAllFormFields();
        }, 500);
    }

    function fillAllFormFields() {
    console.log('Filling form fields with:', formData);
    
    Object.keys(formData).forEach(key => {
        const field = document.querySelector(`[name="${key}"]`);
        if (field && formData[key] !== undefined && formData[key] !== null) {
            if (field.type === 'checkbox') {
                field.checked = formData[key] === true || formData[key] === 'true';
            } else {
                field.value = formData[key];
            }
            console.log(`Set ${key} = ${formData[key]}`);
        }
    });
    
    if (selectedCategory) {
        const categoryField = document.getElementById('selectedCategory');
        if (categoryField) {
            categoryField.value = selectedCategory;
        }
    }
    
    // Restore variant toggles and fields
    if (formData.availableVariants) {
        if (formData.availableVariants.includes('inclusive')) {
            document.getElementById('inclusiveVariantToggle').checked = true;
            toggleVariantSection('inclusive');
            setTimeout(() => {
                document.getElementById('inclusiveDescription').value = formData.inclusiveDescription || '';
                document.getElementById('inclusivePrice').value = formData.inclusivePrice || '';
                document.getElementById('inclusiveNotes').value = formData.inclusiveNotes || '';
            }, 100);
        }
        if (formData.availableVariants.includes('exclusive')) {
            document.getElementById('exclusiveVariantToggle').checked = true;
            toggleVariantSection('exclusive');
            setTimeout(() => {
                document.getElementById('exclusiveDescription').value = formData.exclusiveDescription || '';
                document.getElementById('exclusivePrice').value = formData.exclusivePrice || '';
                document.getElementById('exclusiveNotes').value = formData.exclusiveNotes || '';
                document.getElementById('exclusiveSoldOnce').checked = formData.exclusiveSoldOnce || false;
            }, 100);
        }
    }
}
    // Auth State Observer with Quota Check
    let authCheckTimeout;
    onAuthStateChanged(auth, async (user) => {
        clearTimeout(authCheckTimeout);
        
        if (user) {
            try {
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);
                
                let userData;
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                } else {
                    console.warn('⚠️ User document not found, creating...');
                    userData = {
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0],
                        role: 'seller',
                        subscriptionPlan: 'free',
                        createdAt: new Date().toISOString(),
                        listings: { active: 0, total: 0 },
                        stats: { totalViews: 0, inquiries: 0, sales: 0, alerts: 0, savedSearches: 0 },
                        profile: { bio: '', company: '', website: '', phone: '', location: 'Quezon City, Metro Manila, PH', verified: false },
                        status: 'active'
                    };
                    await setDoc(userDocRef, userData);
                }
                
                if (userData.status === 'suspended') {
                    alert('⚠️ Your account has been suspended. You cannot create or edit listings.\n\nReason: ' + (userData.suspensionReason || 'Account policy violation'));
                    await signOut(auth);
                    window.location.href = 'index.html';
                    return;
                }
                
                if (!isEditMode) {
                    await checkUserQuota(user, userData);
                }
                
                currentUser = user;
                updateUIForLoggedInUser(user);
                
            } catch (error) {
                console.error('Error checking user status:', error);
                currentUser = user;
                updateUIForLoggedInUser(user);
                restoreSavedFormData();
            }
        } else {
            authCheckTimeout = setTimeout(() => {
                currentUser = null;
                updateUIForLoggedOutUser();
            }, 100);
        }
    });

    async function checkUserQuota(user, userData) {
        const plan = userData.subscriptionPlan || 'free';
        
        const now = new Date();
        const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
        
        const monthlyListingsQuery = query(
            collection(db, 'listings'),
            where('userId', '==', user.uid),
            where('createdAt', '>=', firstDayOfMonth)
        );
        
        const monthlyListingsSnapshot = await getDocs(monthlyListingsQuery);
        const monthlyListingsCount = monthlyListingsSnapshot.size;
        
        const quotaLimits = {
            free: 1,
            basic: 3,
            premium: Infinity
        };
        
        const userQuota = quotaLimits[plan] || 1;
        
        userQuotaInfo = {
            plan: plan,
            used: monthlyListingsCount,
            limit: userQuota,
            exceeded: monthlyListingsCount >= userQuota && plan !== 'premium'
        };
        
        displayQuotaInfo(plan, monthlyListingsCount, userQuota);
        
        if (userQuotaInfo.exceeded) {
            showQuotaExceededMessage(plan, userQuota);
            disableListingForm();
        }
    }

    function displayQuotaInfo(plan, used, limit) {
        const quotaInfoHTML = `
            <div class="quota-banner">
                <div class="quota-banner-content">
                    <div class="quota-info">
                        <h4>Your Plan: ${plan.charAt(0).toUpperCase() + plan.slice(1)}</h4>
                        <p>Monthly Listings: <strong>${used} of ${limit === Infinity ? 'Unlimited' : limit}</strong></p>
                    </div>
                    ${plan !== 'premium' ? `
                        <a href="pricing.html" class="upgrade-btn">
                            <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            Upgrade Plan
                        </a>
                    ` : `
                        <div style="background: var(--success); color: white; padding: 0.625rem 1.25rem; border-radius: 6px; font-weight: 600; font-size: 0.875rem;">
                            ✓ Unlimited Listings
                        </div>
                    `}
                </div>
            </div>
        `;
        
        const formColumn = document.querySelector('.form-column');
        if (formColumn && !document.getElementById('quotaInfoBanner')) {
            const banner = document.createElement('div');
            banner.id = 'quotaInfoBanner';
            banner.innerHTML = quotaInfoHTML;
            formColumn.insertAdjacentElement('afterbegin', banner);
        }
    }

    function showQuotaExceededMessage(plan, limit) {
        const messageHTML = `
            <div style="background: rgba(239, 68, 68, 0.05); padding: 2rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid var(--error); text-align: center;">
                <svg style="width: 64px; height: 64px; margin: 0 auto 1rem; color: var(--error);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <h3 style="color: var(--error); margin-bottom: 0.75rem; font-size: 1.5rem; font-weight: 700;">Monthly Listing Quota Reached</h3>
                <p style="color: var(--gray-700); margin-bottom: 1.5rem;">You've reached your ${plan} plan limit of ${limit} listing${limit > 1 ? 's' : ''} per month. Upgrade to list more systems!</p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <a href="pricing.html" class="btn btn-primary" style="display: inline-flex;">
                        <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Upgrade Now
                    </a>
                    <a href="index.html" class="btn btn-secondary" style="display: inline-flex;">
                        <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        Go Home
                    </a>
                </div>
            </div>
        `;
        
        const formContent = document.querySelector('.form-content');
        if (formContent && !document.getElementById('quotaExceededMessage')) {
            const message = document.createElement('div');
            message.id = 'quotaExceededMessage';
            message.innerHTML = messageHTML;
            formContent.insertAdjacentElement('beforebegin', message);
        }
    }

    function disableListingForm() {
        const form = document.getElementById('sellSystemForm');
        if (form) {
            const inputs = form.querySelectorAll('input, textarea, select, button');
            inputs.forEach(input => {
                input.disabled = true;
                input.style.opacity = '0.5';
                input.style.cursor = 'not-allowed';
            });
        }
    }

    function updateUIForLoggedInUser(user) {
        const signInBtn = document.getElementById('signInBtn');
        const userProfile = document.getElementById('userProfile');
        
        requestAnimationFrame(() => {
            if (signInBtn) signInBtn.style.display = 'none';
            if (userProfile) userProfile.classList.add('logged-in');
            
            const userName = document.getElementById('userName');
            if (userName) userName.textContent = user.displayName || user.email.split('@')[0];
            
            const avatarUrl = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=F97316&color=fff`;
            const userAvatar = document.getElementById('userAvatar');
            if (userAvatar) userAvatar.src = avatarUrl;
            
            const authLoading = document.getElementById('authLoading');
            const authRequired = document.getElementById('authRequired');
            const listingForm = document.getElementById('listingForm');
            
            if (authLoading) authLoading.classList.remove('active');
            if (authRequired) authRequired.style.display = 'none';
            if (listingForm) listingForm.style.display = 'block';
        });
        
        if (userProfile) userProfile.onclick = showUserMenu;
    }

    function updateUIForLoggedOutUser() {
        const signInBtn = document.getElementById('signInBtn');
        const userProfile = document.getElementById('userProfile');
        
        requestAnimationFrame(() => {
            if (signInBtn) signInBtn.style.display = 'block';
            if (userProfile) userProfile.classList.remove('logged-in');
            
            const authLoading = document.getElementById('authLoading');
            const authRequiredContent = document.getElementById('authRequiredContent');
            const authRequired = document.getElementById('authRequired');
            const listingForm = document.getElementById('listingForm');
            
            if (authLoading) authLoading.classList.remove('active');
            if (authRequiredContent) authRequiredContent.style.display = 'block';
            if (authRequired) authRequired.style.display = 'block';
            if (listingForm) listingForm.style.display = 'none';
        });
    }

    // Auth Modal Functions
    window.showAuthModal = function() {
        document.getElementById('authModal').classList.add('active');
    }

    window.closeAuthModal = function() {
        document.getElementById('authModal').classList.remove('active');
    }

    window.switchTab = function(tab) {
        const tabs = document.querySelectorAll('.auth-tab');
        const forms = document.querySelectorAll('.auth-form');
        
        tabs.forEach(t => t.classList.remove('active'));
        forms.forEach(f => f.classList.remove('active'));
        
        if (tab === 'signin') {
            tabs[0].classList.add('active');
            document.getElementById('signInForm').classList.add('active');
        } else {
            tabs[1].classList.add('active');
            document.getElementById('signUpForm').classList.add('active');
        }
    }

    // Auth event listeners
    document.addEventListener('DOMContentLoaded', () => {
        const authRequiredBtn = document.getElementById('authRequiredBtn');
        if (authRequiredBtn) {
            authRequiredBtn.addEventListener('click', showAuthModal);
        }
    });

    // Email/Password Sign Up
    document.getElementById('signUpForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('signUpName').value;
        const email = document.getElementById('signUpEmail').value;
        const password = document.getElementById('signUpPassword').value;

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(userCredential.user, { displayName: name });
            
            const userDocRef = doc(db, 'users', userCredential.user.uid);
            await setDoc(userDocRef, {
                email: email,
                name: name,
                role: 'seller',
                subscriptionPlan: 'free',
                createdAt: new Date().toISOString(),
                listings: { active: 0, total: 0 },
                stats: { totalViews: 0, inquiries: 0, sales: 0, alerts: 0, savedSearches: 0 },
                profile: { bio: '', company: '', website: '', phone: '', location: 'Quezon City, Metro Manila, PH', verified: false },
                status: 'active'
            });
            
            closeAuthModal();
        } catch (error) {
            console.error('Error signing up:', error);
            alert(error.message);
        }
    });

    // Email/Password Sign In
    document.getElementById('signInForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('signInEmail').value;
        const password = document.getElementById('signInPassword').value;

        try {
            await signInWithEmailAndPassword(auth, email, password);
            closeAuthModal();
        } catch (error) {
            console.error('Error signing in:', error);
            alert(error.message);
        }
    });

    // Google Sign In
    document.getElementById('googleSignInBtn').addEventListener('click', async () => {
        try {
            const result = await signInWithPopup(auth, googleProvider);
            
            const userDocRef = doc(db, 'users', result.user.uid);
            const userDoc = await getDoc(userDocRef);
            
            if (!userDoc.exists()) {
                await setDoc(userDocRef, {
                    email: result.user.email,
                    name: result.user.displayName,
                    role: 'seller',
                    subscriptionPlan: 'free',
                    createdAt: new Date().toISOString(),
                    listings: { active: 0, total: 0 },
                    stats: { totalViews: 0, inquiries: 0, sales: 0, alerts: 0, savedSearches: 0 },
                    profile: { bio: '', company: '', website: '', phone: '', location: '', verified: false },
                    status: 'active'
                });
            }
            
            closeAuthModal();
        } catch (error) {
            console.error('Error signing in with Google:', error);
            alert('Failed to sign in with Google. Please try again.');
        }
    });

    // User Menu
    window.showUserMenu = function(event) {
        event.stopPropagation();
        
        const existingMenu = document.getElementById('userDropdownMenu');
        if (existingMenu) {
            existingMenu.remove();
            return;
        }
        
        const menu = document.createElement('div');
        menu.id = 'userDropdownMenu';
        menu.style.cssText = `
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 220px;
            z-index: 1000;
            overflow: hidden;
        `;
        
        menu.innerHTML = `
            <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                <div style="font-weight: 600; margin-bottom: 0.25rem; font-size: 0.9375rem;">${currentUser.displayName || 'User'}</div>
                <div style="font-size: 0.8125rem; color: var(--gray-500);">${currentUser.email}</div>
            </div>
            <div style="padding: 0.5rem 0;">
                <a href="dashboard.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--text); text-decoration: none; transition: background 0.2s; font-size: 0.9375rem;">
                    <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="profile.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--text); text-decoration: none; transition: background 0.2s; font-size: 0.9375rem;">
                    <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>Profile</span>
                </a>
                <div style="height: 1px; background: var(--border); margin: 0.5rem 0;"></div>
                <a href="#" onclick="handleSignOut(event)" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: var(--error); text-decoration: none; transition: background 0.2s; font-size: 0.9375rem;">
                    <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    <span>Sign Out</span>
                </a>
            </div>
        `;
        
        menu.querySelectorAll('a').forEach(link => {
            link.addEventListener('mouseenter', function() {
                this.style.background = 'var(--gray-50)';
            });
            link.addEventListener('mouseleave', function() {
                this.style.background = '';
            });
        });
        
        const userProfileEl = document.querySelector('.user-profile');
        if (userProfileEl) {
            userProfileEl.style.position = 'relative';
            userProfileEl.appendChild(menu);
        }
        
        setTimeout(() => {
            document.addEventListener('click', closeUserMenu);
        }, 0);
    }

    function closeUserMenu() {
        const menu = document.getElementById('userDropdownMenu');
        if (menu) {
            menu.remove();
        }
        document.removeEventListener('click', closeUserMenu);
    }

    window.handleSignOut = async function(event) {
        event.preventDefault();
        closeUserMenu();
        
        if (confirm('Are you sure you want to sign out?')) {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Failed to sign out. Please try again.');
            }
        }
    }

    // Select Category
    window.selectCategory = function(category) {
        selectedCategory = category;
        
        document.querySelectorAll('.category-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        const categoryCard = document.querySelector(`[data-category="${category}"]`);
        if (categoryCard) categoryCard.classList.add('selected');
        
        const categoryField = document.getElementById('selectedCategory');
        if (categoryField) categoryField.value = category;
        
        generateCategoryFields(category);
    }

    

window.selectLicenseType = function(licenseType) {
    selectedLicense = licenseType;
    
    // Hide all fields first
    document.getElementById('inclusiveVariantFields').style.display = 'none';
    document.getElementById('exclusiveVariantFields').style.display = 'none';
    
    // Clear all requirements
    ['inclusiveDescription', 'inclusivePrice', 'exclusiveDescription', 'exclusivePrice'].forEach(id => {
        const field = document.getElementById(id);
        if (field) {
            field.required = false;
        }
    });
    
    // Show selected license fields
    const selectedFields = document.getElementById(`${licenseType}VariantFields`);
    const description = document.getElementById(`${licenseType}Description`);
    const price = document.getElementById(`${licenseType}Price`);
    
    if (selectedFields) selectedFields.style.display = 'block';
    if (description) description.required = true;
    if (price) price.required = true;
    
    // Update hidden field
    const variantsField = document.getElementById('availableVariants');
    if (variantsField) variantsField.value = licenseType;
};


function updateAvailableVariantsField() {
    const availableVariants = [];
    if (selectedVariants.inclusive) availableVariants.push('inclusive');
    if (selectedVariants.exclusive) availableVariants.push('exclusive');
    
    const variantsField = document.getElementById('availableVariants');
    if (variantsField) variantsField.value = availableVariants.join(',');
}




    // Generate category-specific fields
    function generateCategoryFields(category) {
        const container = document.getElementById('categorySpecificFields');
        const config = categoryFields[category];
        
        if (!config) {
            container.innerHTML = '<p>Category configuration not found.</p>';
            return;
        }
        
        let html = `
            <div class="section-header">
                <h2>${config.name} Details</h2>
                <p>Please provide detailed information about your ${config.name.toLowerCase()}</p>
            </div>
        `;
        
        config.fields.forEach(field => {
            if (field.type === 'text' || field.type === 'number') {
                html += `
                    <div class="form-group">
                        <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                        <input 
                            type="${field.type}" 
                            class="form-input" 
                            name="${field.name}" 
                            ${field.required ? 'required' : ''} 
                            placeholder="${field.placeholder || ''}"
                            ${field.maxlength ? `maxlength="${field.maxlength}"` : ''}
                            ${field.step ? `step="${field.step}"` : ''}
                        >
                        ${field.hint ? `<div class="form-hint">${field.hint}</div>` : ''}
                    </div>
                `;
            } else if (field.type === 'textarea') {
                html += `
                    <div class="form-group">
                        <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                        <textarea 
                            class="form-textarea" 
                            name="${field.name}" 
                            ${field.required ? 'required' : ''} 
                            placeholder="${field.placeholder || ''}"
                            ${field.maxlength ? `maxlength="${field.maxlength}"` : ''}
                            ${field.rows ? `style="min-height: ${field.rows * 30}px;"` : ''}
                        ></textarea>
                        ${field.hint ? `<div class="form-hint">${field.hint}</div>` : ''}
                    </div>
                `;
            } else if (field.type === 'select') {
                html += `
                    <div class="form-group">
                        <label>${field.label} ${field.required ? '<span class="required">*</span>' : ''}</label>
                        <select class="form-select" name="${field.name}" ${field.required ? 'required' : ''}>
                            <option value="">Select ${field.label}</option>
                            ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                        </select>
                        ${field.hint ? `<div class="form-hint">${field.hint}</div>` : ''}
                        </div>
                    `;
                }
            });
        container.innerHTML = html;
        
        if (isEditMode) {
            setTimeout(fillAllFormFields, 100);
        }
    }

    // Image Upload
    const imageUploadContainer = document.getElementById('imageUploadContainer');
    if (imageUploadContainer) {
        imageUploadContainer.addEventListener('click', function() {
            if (uploadedImages.length < MAX_IMAGES) {
                document.getElementById('imageUpload').click();
            } else {
                alert(`Maximum ${MAX_IMAGES} images allowed`);
            }
        });
    }

    const imageUpload = document.getElementById('imageUpload');
    if (imageUpload) {
        imageUpload.addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            
            if (uploadedImages.length + files.length > MAX_IMAGES) {
                alert(`You can only upload up to ${MAX_IMAGES} images. Currently you have ${uploadedImages.length} image(s).`);
                return;
            }

            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name} is larger than 5MB. Please choose a smaller file.`);
                    continue;
                }

                if (!file.type.startsWith('image/')) {
                    alert(`${file.name} is not an image file.`);
                    continue;
                }

                await uploadImageToCloudinary(file);
            }

            e.target.value = '';
        });
    }

    async function uploadImageToCloudinary(file) {
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadStatus = document.getElementById('uploadStatus');
        const uploadPercentage = document.getElementById('uploadPercentage');
        const progressBar = document.getElementById('progressBar');

        if (uploadProgress) uploadProgress.classList.add('active');
        if (uploadStatus) uploadStatus.textContent = `Uploading ${file.name}...`;
        if (uploadPercentage) uploadPercentage.textContent = '0%';
        if (progressBar) progressBar.style.width = '0%';

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        formData.append('folder', 'systemly-listings');

        try {
            const xhr = new XMLHttpRequest();

            xhr.upload.addEventListener('progress', (e) => {
                if (e.lengthComputable) {
                    const percentComplete = Math.round((e.loaded / e.total) * 100);
                    if (uploadPercentage) uploadPercentage.textContent = percentComplete + '%';
                    if (progressBar) progressBar.style.width = percentComplete + '%';
                }
            });

            xhr.addEventListener('load', () => {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    
                    uploadedImages.push({
                        url: response.secure_url,
                        display_url: response.secure_url,
                        thumb: response.secure_url.replace('/upload/', '/upload/c_thumb,w_200,h_200,g_face/'),
                        public_id: response.public_id,
                        filename: file.name
                    });
                    
                    renderImagePreviews();
                    if (uploadStatus) uploadStatus.textContent = 'Upload complete!';
                    
                    setTimeout(() => {
                        if (uploadProgress) uploadProgress.classList.remove('active');
                    }, 1000);
                } else {
                    throw new Error(`Upload failed with status ${xhr.status}`);
                }
            });

            xhr.addEventListener('error', () => {
                console.error('Upload error');
                alert(`Failed to upload ${file.name}. Please try again.`);
                if (uploadProgress) uploadProgress.classList.remove('active');
            });

            xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`);
            xhr.send(formData);

        } catch (error) {
            console.error('Error uploading image:', error);
            alert(`Failed to upload ${file.name}. Please try again.`);
            if (uploadProgress) uploadProgress.classList.remove('active');
        }
    }

    function renderImagePreviews() {
        const grid = document.getElementById('imagePreviewGrid');
        if (!grid) return;
        
        grid.innerHTML = uploadedImages.map((img, index) => `
            <div class="image-preview-item">
                <img src="${img.display_url}" alt="Preview ${index + 1}">
                <button class="remove-image" onclick="removeImage(${index})" type="button">×</button>
                ${index === 0 ? '<div style="position: absolute; bottom: 0.5rem; left: 0.5rem; background: var(--primary); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.6875rem; font-weight: 600;">Main</div>' : ''}
            </div>
        `).join('');
    }

    window.removeImage = function(index) {
        if (confirm('Are you sure you want to remove this image?')) {
            uploadedImages.splice(index, 1);
            renderImagePreviews();
        }
    }

    // Drag and drop for images
    if (imageUploadContainer) {
        imageUploadContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = 'var(--primary)';
            this.style.background = 'rgba(37, 99, 235, 0.05)';
        });

        imageUploadContainer.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = '';
            this.style.background = '';
        });

        imageUploadContainer.addEventListener('drop', async function(e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.borderColor = '';
            this.style.background = '';

            const files = Array.from(e.dataTransfer.files);
            
            if (uploadedImages.length + files.length > MAX_IMAGES) {
                alert(`You can only upload up to ${MAX_IMAGES} images. Currently you have ${uploadedImages.length} image(s).`);
                return;
            }

            for (const file of files) {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name} is larger than 5MB. Please choose a smaller file.`);
                    continue;
                }

                if (!file.type.startsWith('image/')) {
                    alert(`${file.name} is not an image file.`);
                    continue;
                }

                await uploadImageToCloudinary(file);
            }
        });
    }

    // Form Navigation
   window.changeStep = function(direction) {
    console.log('📍 Current step:', currentStep, '→ Moving:', direction);
    
    if (direction === 1) {
            // Validate category selection on step 1
            if (currentStep === 1 && !selectedCategory) {
                alert('Please select a business category to continue');
                return;
            }

            // Validate required fields
            if (!validateStep(currentStep)) {
                return;
            }

            // Validate images on step 3
            if (currentStep === 3 && uploadedImages.length === 0) {
                alert('Please upload at least one image of your system');
                return;
            }

          // Validate variants and pricing on step 4
// Validate variants and pricing on step 4
// Validate license selection on step 4
if (currentStep === 4) {
    if (!selectedLicense) {
        alert('Please select a license type (Inclusive or Exclusive)');
        return;
    }
    
    const desc = document.getElementById(`${selectedLicense}Description`).value.trim();
    const price = document.getElementById(`${selectedLicense}Price`).value;
    
    if (!desc) {
        alert(`Please describe what's included in the ${selectedLicense} license`);
        document.getElementById(`${selectedLicense}Description`).focus();
        return;
    }
    if (!price || price <= 0) {
        alert(`Please set a valid price for the ${selectedLicense} license`);
        document.getElementById(`${selectedLicense}Price`).focus();
        return;
    }
}
}

        saveStepData(currentStep);

        const newStep = currentStep + direction;
        
        if (newStep < 1 || newStep > totalSteps) return;

        const currentStepEl = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        const currentStepIndicator = document.querySelector(`.step[data-step="${currentStep}"]`);
        if (currentStepEl) currentStepEl.classList.remove('active');
        if (currentStepIndicator) currentStepIndicator.classList.remove('active');

        currentStep = newStep;
        
        const newStepEl = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        const newStepIndicator = document.querySelector(`.step[data-step="${currentStep}"]`);
        if (newStepEl) newStepEl.classList.add('active');
        if (newStepIndicator) newStepIndicator.classList.add('active');

        for (let i = 1; i < currentStep; i++) {
            const stepIndicator = document.querySelector(`.step[data-step="${i}"]`);
            if (stepIndicator) stepIndicator.classList.add('completed');
        }

// Calculate progress with proper offset to center on step circles
const progress = ((currentStep - 1) / (totalSteps - 1)) * 90; // Changed from 100 to 90
const progressLine = document.getElementById('progressLine');
if (progressLine) progressLine.style.width = progress + '%';

        updateButtons();

        if (currentStep === 6) {
            populateReview();
        }

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function validateStep(step) {
        const stepElement = document.querySelector(`.form-step[data-step="${step}"]`);
        if (!stepElement) return true;
        
        const requiredFields = stepElement.querySelectorAll('[required]');
        
        for (let field of requiredFields) {
            if (!field.value.trim()) {
                alert('Please fill in all required fields');
                field.focus();
                return false;
            }
        }
        return true;
    }

function saveStepData(step) {
    const stepElement = document.querySelector(`.form-step[data-step="${step}"]`);
    if (!stepElement) return;
    
    const inputs = stepElement.querySelectorAll('input, select, textarea');
    
    inputs.forEach(input => {
        if (input.name && input.type !== 'file') {
            formData[input.name] = input.value;
        }
    });

    if (step === 3) {
        formData.images = uploadedImages.map(img => img.display_url);
        formData.mainImage = uploadedImages.length > 0 ? uploadedImages[0].display_url : null;
    }

if (step === 4) {
    if (selectedLicense) {
        formData.availableVariants = [selectedLicense];
        formData[`${selectedLicense}Description`] = document.getElementById(`${selectedLicense}Description`).value;
        formData[`${selectedLicense}Price`] = document.getElementById(`${selectedLicense}Price`).value;
        formData[`${selectedLicense}Notes`] = document.getElementById(`${selectedLicense}Notes`).value;
        
        if (selectedLicense === 'exclusive') {
            formData.exclusiveSoldOnce = document.getElementById('exclusiveSoldOnce').checked;
        }
    }
}
    
    // SAVE TO SESSION STORAGE
    sessionStorage.setItem('listingFormData', JSON.stringify(formData));
    sessionStorage.setItem('currentStep', currentStep);
    sessionStorage.setItem('selectedCategory', selectedCategory);
    sessionStorage.setItem('uploadedImages', JSON.stringify(uploadedImages));
    sessionStorage.setItem('selectedLicense', selectedLicense);
}




function restoreSavedFormData() {
    try {
        const savedFormData = sessionStorage.getItem('listingFormData');
        const savedStep = sessionStorage.getItem('currentStep');
        const savedCategory = sessionStorage.getItem('selectedCategory');
        const savedImages = sessionStorage.getItem('uploadedImages');
        const savedVariants = sessionStorage.getItem('selectedVariants');
        
        if (savedFormData) {
            Object.assign(formData, JSON.parse(savedFormData));
            console.log('✅ Restored form data');
        }
        
        if (savedCategory) {
            selectedCategory = savedCategory;
            selectCategory(savedCategory);
            console.log('✅ Restored category:', savedCategory);
        }
        
        if (savedImages) {
            const images = JSON.parse(savedImages);
            uploadedImages.length = 0;
            uploadedImages.push(...images);
            renderImagePreviews();
            console.log('✅ Restored images:', uploadedImages.length);
        }
        
      const savedLicense = sessionStorage.getItem('selectedLicense');
if (savedLicense) {
    selectedLicense = savedLicense;
    document.getElementById(`${savedLicense}VariantToggle`).checked = true;
    selectLicenseType(savedLicense);
    console.log('✅ Restored license:', savedLicense);
}
        
        // Restore step
        if (savedStep && parseInt(savedStep) > 1) {
            setTimeout(() => {
                const targetStep = parseInt(savedStep);
                for (let i = 1; i < targetStep; i++) {
                    currentStep = i;
                    changeStep(1);
                }
                fillAllFormFields();
            }, 500);
            console.log('✅ Restored to step:', savedStep);
        } else {
            // Still fill fields even on step 1
            setTimeout(fillAllFormFields, 300);
        }
        
    } catch (error) {
        console.error('Error restoring form data:', error);
    }
}


















   function updateButtons() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');

    console.log('🔘 Updating buttons for step:', currentStep, '/', totalSteps);

    if (prevBtn) prevBtn.style.display = currentStep === 1 ? 'none' : 'inline-flex';
        
    if (currentStep === totalSteps) {
        if (nextBtn) nextBtn.style.display = 'none';
        if (submitBtn) {
            submitBtn.style.display = 'inline-flex';
            submitBtn.innerHTML = isEditMode ? 
                `<svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Update Listing` :
                `<svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Submit Listing`;
        }
    } else {
        if (nextBtn) nextBtn.style.display = 'inline-flex';
        if (submitBtn) submitBtn.style.display = 'none';
    }
}

    function populateReview() {
    const reviewContent = document.getElementById('reviewContent');
    if (!reviewContent) return;
    
    const categoryName = categoryFields[selectedCategory]?.name || 'Business';
    
    reviewContent.innerHTML = `
        <style>
            .review-grid {
                display: grid;
                grid-template-columns: 200px 1fr;
                gap: 1.5rem 2rem;
                margin-bottom: 2rem;
            }
            
            .review-label {
                font-weight: 600;
                color: var(--gray-700);
                font-size: 0.875rem;
            }
            
            .review-value {
                color: var(--gray-900);
                font-size: 0.9375rem;
                line-height: 1.6;
            }
            
            .review-divider {
                grid-column: 1 / -1;
                height: 1px;
                background: var(--border);
                margin: 0.5rem 0;
            }
            
            .review-section-title {
                grid-column: 1 / -1;
                font-size: 1.125rem;
                font-weight: 700;
                color: var(--gray-900);
                margin-top: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid var(--primary);
            }
            
            .review-images {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            .review-images img {
                width: 100px;
                height: 100px;
                object-fit: cover;
                border-radius: 6px;
                border: 2px solid var(--border);
            }
            
            .review-images img:first-child {
                border-color: var(--primary);
            }
            
            .review-variant {
                background: var(--gray-50);
                padding: 1rem;
                border-radius: 6px;
                border-left: 3px solid var(--primary);
                margin-bottom: 1rem;
            }
            
            .review-variant:last-child {
                border-left-color: var(--success);
            }
            
            .review-variant-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.75rem;
            }
            
            .review-variant-name {
                font-weight: 700;
                color: var(--gray-900);
                font-size: 1rem;
            }
            
            .review-variant-price {
                font-weight: 800;
                color: var(--primary);
                font-size: 1.25rem;
            }
            
            .review-variant-desc {
                color: var(--gray-700);
                font-size: 0.875rem;
                line-height: 1.6;
                white-space: pre-wrap;
                margin-bottom: 0.5rem;
            }
            
            .review-variant-note {
                background: rgba(37, 99, 235, 0.1);
                color: var(--primary);
                padding: 0.5rem;
                border-radius: 4px;
                font-size: 0.8125rem;
                margin-top: 0.5rem;
            }
            
            @media (max-width: 768px) {
                .review-grid {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }
                
                .review-label {
                    font-weight: 700;
                }
            }
        </style>
        
        <div class="review-grid">
            <!-- CATEGORY SECTION -->
            <div class="review-section-title">Category & Type</div>
            
            <div class="review-label">Business Type</div>
            <div class="review-value">${categoryName}</div>
            
            ${formData.systemName ? `
            <div class="review-label">Name</div>
            <div class="review-value">${formData.systemName}</div>
            ` : ''}
            
            ${formData.shortDescription ? `
            <div class="review-label">Short Description</div>
            <div class="review-value">${formData.shortDescription}</div>
            ` : ''}
            
            <div class="review-divider"></div>
            
            <!-- IMAGES SECTION -->
            ${uploadedImages.length > 0 ? `
            <div class="review-section-title">Images (${uploadedImages.length})</div>
            
            <div class="review-label">Gallery</div>
            <div class="review-value">
                <div class="review-images">
                    ${uploadedImages.map((img, index) => `
                        <img src="${img.display_url}" alt="Image ${index + 1}">
                    `).join('')}
                </div>
                <div style="font-size: 0.8125rem; color: var(--gray-500); margin-top: 0.5rem;">
                    First image will be used as main thumbnail
                </div>
            </div>
            
            <div class="review-divider"></div>
            ` : ''}
            
            <!-- PRICING SECTION -->
            <div class="review-section-title">Pricing & License Options</div>
            
            <div class="review-label">Available Licenses</div>
            <div class="review-value">
                ${formData.availableVariants && formData.availableVariants.includes('inclusive') ? `
                <div class="review-variant">
                    <div class="review-variant-header">
                        <span class="review-variant-name">✓ Inclusive License</span>
                        <span class="review-variant-price">₱${parseInt(formData.inclusivePrice).toLocaleString()}</span>
                    </div>
                    <div class="review-variant-desc">${formData.inclusiveDescription}</div>
                    ${formData.inclusiveNotes ? `<div class="review-variant-note"> ${formData.inclusiveNotes}</div>` : ''}
                </div>
                ` : ''}
                
                ${formData.availableVariants && formData.availableVariants.includes('exclusive') ? `
                <div class="review-variant">
                    <div class="review-variant-header">
                        <span class="review-variant-name">✓ Exclusive License</span>
                        <span class="review-variant-price">₱${parseInt(formData.exclusivePrice).toLocaleString()}</span>
                    </div>
                    <div class="review-variant-desc">${formData.exclusiveDescription}</div>
                    ${formData.exclusiveNotes ? `<div class="review-variant-note"> ${formData.exclusiveNotes}</div>` : ''}
                    ${formData.exclusiveSoldOnce ? `<div class="review-variant-note" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">🔒 Can only be sold once</div>` : ''}
                </div>
                ` : ''}
            </div>
            
            <div class="review-divider"></div>
            
            <!-- FINANCIAL SECTION -->
            <div class="review-section-title">Financial Information</div>
            
            ${formData.monthlyRevenue ? `
            <div class="review-label">Monthly Revenue</div>
            <div class="review-value">₱${parseInt(formData.monthlyRevenue).toLocaleString()}</div>
            ` : ''}
            
            ${formData.monthlyProfit ? `
            <div class="review-label">Monthly Profit</div>
            <div class="review-value">₱${parseInt(formData.monthlyProfit).toLocaleString()}</div>
            ` : ''}
            
            ${formData.reasonForSelling ? `
            <div class="review-label">Reason for Selling</div>
            <div class="review-value">${formData.reasonForSelling}</div>
            ` : ''}
            
            ${formData.systemAge ? `
            <div class="review-label">System Age</div>
            <div class="review-value">${formData.systemAge}</div>
            ` : ''}
            
            ${formData.supportPeriod ? `
            <div class="review-label">Support Period</div>
            <div class="review-value">${formData.supportPeriod}</div>
            ` : ''}
        </div>
    `;
}





// Success Notification Function
function showSuccessNotification(title, message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border: 2px solid var(--success);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        z-index: 9999;
        max-width: 400px;
        animation: slideInRight 0.3s ease;
    `;
    
    notification.innerHTML = `
        <style>
            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        </style>
        <div style="display: flex; gap: 1rem; align-items: start;">
            <svg style="width: 32px; height: 32px; color: var(--success); flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div style="flex: 1;">
                <h3 style="font-size: 1.125rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">${title}</h3>
                <p style="font-size: 0.9375rem; color: var(--gray-600); line-height: 1.5; margin: 0;">${message}</p>
            </div>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}










    // Form Submission
    const sellSystemForm = document.getElementById('sellSystemForm');
    if (sellSystemForm) {
        sellSystemForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentUser) {
                alert('Please sign in to submit your listing');
                return;
            }

            try {
                const userDocRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    if (userData.status === 'suspended') {
                        alert('⚠️ Your account is suspended. You cannot submit listings.');
                        await signOut(auth);
                        window.location.href = 'index.html';
                        return;
                    }
                }
            } catch (error) {
                console.error('Error checking user status:', error);
            }

            if (!isEditMode && userQuotaInfo && userQuotaInfo.exceeded) {
                alert(`You've reached your ${userQuotaInfo.plan} plan limit. Please upgrade to list more systems.`);
                window.location.href = 'pricing.html';
                return;
            }

            const agreeTerms = document.getElementById('agreeTerms');
            if (agreeTerms && !agreeTerms.checked) {
                alert('Please agree to the terms of service');
                return;
            }

            if (uploadedImages.length === 0) {
                alert('Please upload at least one image');
                return;
            }

            if (!selectedCategory) {
                alert('Please select a business category');
                return;
            }
if (!selectedLicense) {
    alert('Please select a license type');
    return;
}

            saveStepData(currentStep);

            try {
                const submitBtn = document.getElementById('submitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = `<svg style="width: 18px; height: 18px; margin-right: 0.5rem; animation: spin 1s linear infinite;" fill="none" viewBox="0 0 24 24"><circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path style="opacity: 0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>${isEditMode ? 'Updating...' : 'Submitting...'}`;
                submitBtn.disabled = true;

                const listingData = {
    ...formData,
    category: selectedCategory,
    categoryName: categoryFields[selectedCategory]?.name || '',
    availableVariants: formData.availableVariants,
    variants: [],
                    images: uploadedImages.map(img => img.display_url),
                    mainImage: uploadedImages[0].display_url,
                    thumbnails: uploadedImages.map(img => img.thumb),
                    imageCount: uploadedImages.length,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    status: isEditMode ? (editingListingData.status || 'pending') : 'pending',
                    views: isEditMode ? (editingListingData.views || 0) : 0,
                    inquiries: isEditMode ? (editingListingData.inquiries || 0) : 0
                };

// Build variants array
// Build variants array with seller-defined content
if (formData.availableVariants.includes('inclusive')) {
    listingData.variants.push({
        type: 'inclusive',
        name: 'Inclusive Variant',
        price: parseInt(formData.inclusivePrice),
        description: formData.inclusiveDescription,
        notes: formData.inclusiveNotes || '',
        available: true
    });
}

if (formData.availableVariants.includes('exclusive')) {
    listingData.variants.push({
        type: 'exclusive',
        name: 'Exclusive Variant',
        price: parseInt(formData.exclusivePrice),
        description: formData.exclusiveDescription,
        notes: formData.exclusiveNotes || '',
        soldOnce: formData.exclusiveSoldOnce || false,
        available: true
    });
}










if (isEditMode) {
    listingData.updatedAt = serverTimestamp();
    
    const listingRef = doc(db, 'listings', editingListingId);
    await updateDoc(listingRef, listingData);
    
    console.log('✅ Listing updated:', editingListingId);
    
    sessionStorage.removeItem('editingListingId');
    sessionStorage.removeItem('editingListingData');
    sessionStorage.removeItem('listingFormData');
    sessionStorage.removeItem('currentStep');
    sessionStorage.removeItem('selectedCategory');
    sessionStorage.removeItem('uploadedImages');
    sessionStorage.removeItem('selectedLicense');
    
    // Show success notification
    showSuccessNotification('✅ Listing Updated!', 'Your listing has been updated successfully and is now live.');
    
    setTimeout(() => {
        window.location.href = 'marketplace.html?tab=listings';
    }, 2000);
    
} else {
    listingData.createdAt = serverTimestamp();
    const docRef = await addDoc(collection(db, 'listings'), listingData);
    console.log('✅ Listing created with ID:', docRef.id);

    const userDocRef = doc(db, 'users', currentUser.uid);
    await updateDoc(userDocRef, {
        'listings.active': increment(1),
        'listings.total': increment(1)
    });

    sessionStorage.removeItem('listingFormData');
    sessionStorage.removeItem('currentStep');
    sessionStorage.removeItem('selectedCategory');
    sessionStorage.removeItem('uploadedImages');
    sessionStorage.removeItem('selectedLicense');

    // Show success notification
    showSuccessNotification(
        '🎉 Listing Submitted Successfully!', 
        'Your listing is now under review. Our team will verify the information and publish it within 24-48 hours. You\'ll receive an email notification once it\'s approved.'
    );

    setTimeout(() => {
        sellSystemForm.style.display = 'none';
        const progressSteps = document.querySelector('.progress-bar-wrapper');
        if (progressSteps) progressSteps.style.display = 'none';
        
        const successMessage = document.getElementById('successMessage');
        if (successMessage) successMessage.classList.add('active');
    }, 3000);
}

            } catch (error) {
                console.error('❌ Error submitting listing:', error);
                alert('Failed to ' + (isEditMode ? 'update' : 'submit') + ' listing. Please try again.');
                
                const submitBtn = document.getElementById('submitBtn');
                if (submitBtn) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            }
        });
    }




    // Close modal when clicking outside
    const authModal = document.getElementById('authModal');
    if (authModal) {
        authModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuthModal();
            }
        });
    }

    // Make all steps clickable (forward and backward)
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.step').forEach((step, index) => {
        step.addEventListener('click', function() {
            const targetStep = index + 1;
            
            // Allow going back OR going forward to next step only
            if (targetStep < currentStep || targetStep === currentStep + 1) {
                // Validate current step before moving forward
                if (targetStep > currentStep) {
                    if (currentStep === 1 && !selectedCategory) {
                        alert('Please select a business category first');
                        return;
                    }
                    if (!validateStep(currentStep)) {
                        return;
                    }
                    if (currentStep === 3 && uploadedImages.length === 0) {
                        alert('Please upload at least one image');
                        return;
                    }
                    if (currentStep === 4) {
                        if (!selectedVariants.inclusive && !selectedVariants.exclusive) {
                            alert('Please enable at least one license option');
                            return;
                        }
                        if (selectedVariants.inclusive) {
                            const desc = document.getElementById('inclusiveDescription').value.trim();
                            const price = document.getElementById('inclusivePrice').value;
                            if (!desc || !price || price <= 0) {
                                alert('Please complete the Inclusive license details');
                                return;
                            }
                        }
                        if (selectedVariants.exclusive) {
                            const desc = document.getElementById('exclusiveDescription').value.trim();
                            const price = document.getElementById('exclusivePrice').value;
                            if (!desc || !price || price <= 0) {
                                alert('Please complete the Exclusive license details');
                                return;
                            }
                        }
                    }
                }
                
                const stepsToMove = targetStep - currentStep;
                changeStep(stepsToMove);
            }
        });
    });
});

// Initialize buttons on page load
    updateButtons();
    console.log('✅ Systemly Sell Form initialized');
    console.log('📦 Cloudinary API ready');
    console.log('🔢 Max images:', MAX_IMAGES);
    console.log('📁 Total categories:', Object.keys(categoryFields).length);
    console.log('✏️ Edit mode:', isEditMode);
</script>
</body>
</html>
